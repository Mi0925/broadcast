<div class="gb-table">
	<div class="taskmsg" id="tablemore"> 
		<div class="tkrange">
			<div class="tklay">
				<span class="talay-word"><i class="iconfont icon-rili"></i>发布时间</span>
				<div class="layui-input-inline">
			        <input type="text" class="layui-input" id="daterg" placeholder="选择时间范围">
			        <span class="tocho iconfont icon-shijian" id="tochobtn"></span> 
		    	</div>
		    	<div class="newtk-btn" id="tochocase">
		    		<span class="catonew">新建资源<i class="iconfont icon-arrow-bottom"></i></span>
		    		<ul class="tonewlist">
		    			<li>
		    				<a href="#/newPlatResoInfo" class="newtk-btn add_tab" url="components/newPlatResoInfo.html" name="新建平台资源信息">新建平台资源信息</a>
		    			</li>
		    			<li>
		    				<a href="#/newJuniorTerminal" class="newtk-btn add_tab" url="components/newJuniorTerminal.html" name="新建下级终端">新建下级终端</a>
		    			</li>
		    			<li>
		    				<a href="#/newStationResoInfo" class="newtk-btn add_tab" url="components/newStationResoInfo.html" name="新建台站">新建台站</a>
		    			</li>
		    			<li>
		    				<input type="file" class="leadin" accept="xls,xlsx"  data-type="loading"/>
		    				<a href="javascript:void(0);" class="newtk-btn">快速导入（excel）</a>
		    			</li>
		    		</ul>
		    	</div>
			</div>
			<div class="tksearch">
				<input type="text" value="请输入资源编码 ，资源名称，所属地区" onfocus="if(this.value==defaultValue){this.value = '';this.style.color='#333'}" onblur="if(!value){this.value = defaultValue;this.style.color='#ccc';}" class="dsearch" aria-controls="table-main"/>
				<span class="tksrh-btn"><i class="iconfont icon-sousuo"></i></span>
			</div>
		</div>
		<div class="restable">
			<div class="resochos">
				<div class="resodiv">
					<ul class="resolist resolist-confirm">
						<li class="resact" resval="true">已确认资源</li>
						<li resval="false">待确认资源</li>
					</ul>
				</div>
				<div class="resodiv">
					<ul class="resolist resolist-res">
						<li class="resact j-platform" resval="/res/platform/all">平台资源信息</li>
						<li class="j-sub" resval="/res/sub/all">下级终端</li>
						<li class="j-station" resval="/res/station/all">发射台资源信息</li>
					</ul>
					<span class="resnav"><i class="iconfont icon-chuangjianzuanqumulu"></i></span>
				</div>
				<div class="resodiv">
					<ul class="resolist resolist-status">
						<li class="resact" resval="0">全部</li>
						<li resval="1">新增状态异常<span class="resmsg">11</span></li>
						<li resval="2">新增状态正常</li>
					</ul>
				</div>
			</div>
			<div class="thetab" id="table-main">
				<div class="tablecont">
					<table class="table-main display" cellspacing="0" width="100%">
						<thead>
							<tr>
								<th></th>
								<th>序号</th>
								<th>编码</th>
								<th>工作状态</th>
								<th>平台类别</th>
								<th>系统类别</th>
								<th>平台名称</th>
								<th>服务器地址</th>
								<th>所属地区</th>
								<th>创建时间</th>
								<th>操作</th>
								<th></th>
							</tr>
						</thead>
						<tfoot>
							<tr>
								<th></th>
								<th></th>
								<th></th>
								<th></th>
								<th></th>
								<th></th>
								<th></th>
								<th></th>
								<th></th>
								<th></th>
								<th></th>
								<th></th>
							</tr>
						</tfoot>
						<tbody></tbody>
					</table>
				</div>
				<div class="theche">
					<div class="tocheck">
						<input type="checkbox" name="checkall" id="checkAll" />
						<label for="checkAll">全选</label>
					</div>
					<span class="chedel j-del-tr"> 
						<i class="iconfont icon-shanchu"></i>
						删除
					</span>
				</div>
			</div>
			<div class="treediv">
				<div class="gb-tree scroll" id="treea">
					<ul id="gb_tree_resource1" class="ztree ztree-resource"></ul>
					<button class="layui-btn add-watch-ok layui-btn-sm bg4579d8" onclick="addResourceClick()">添加地区</button>
				</div>
			</div>
		</div>
		<p class="botword">© 2017-2018 浙江省应急广播平台</p>
	</div>
	
	<div class="popwindow popnone"></div>
	<div class="tolead">
		<p class="poptit">导入excel</p>
		<span class="popclose"><i class="iconfont icon-guanbi"></i></span>
		<div class="leadiv">
			<div class="layui-progress layui-progress-big" lay-filter="demo" lay-showpercent="true">
				<div class="layui-progress-bar" lay-percent="0%"></div>
			</div>
			<p class="leadhint">正在导入<span class="lefile">xxx.xls</span></p>
			<p class="succmat"><i class="iconfont icon-11"></i>转换成功！</p>
		</div>
	</div>
	<div class="choose">
		<p class="choword">确定删除此任务消息吗？</p>
		<div class="chobtn">
			<input type="button" value="删除" class="chopri j-del-tr" />
			<input type="button" value="取消" class="cho-cancel" />
		</div>
		<span class="triangle"><em></em></span>
	</div>
</div>
<div class="gb-dialog gb-dialog-add-area" style="display: none;">
	<form class="layui-form" action="">
		<div class="gb-dialog-main i">
			<h3 class="gb-dialog-title">
				<i class="iconfont icon-guanbi j-close-dialog"></i>
			</h3>
			<div style="width: 500px;height: 500px; padding: 0 15px;">
				<div class="settingone" style="margin-bottom: 0;">
					<p class="oneitem-tit"><small>*</small>上级单位</p>
					<div class="oneimp" style="width: 100%">
						<input type="text" readonly id="region" name="region" class="imptxt" id="citySel" lay-verify="required" onclick="showMenu();"/>
						<div id="menuContent" class="gb-tree scroll" style="display:none;bottom: auto!important;">
							<ul id="treeDemo" class="ztree"></ul>
						</div>
					</div>
				</div>
				<div class="settingone" style="margin-bottom: 0;">
					<p class="oneitem-tit"><small>*</small>地区名</p>
					<div class="oneimp" style="width: 100%">
						<input type="text" id="regionName" name="regionName" class="imptxt" lay-verify="required"/>
					</div>
				</div>
				<div class="settingone" style="margin-bottom: 0;">
					<p class="oneitem-tit"><small>*</small>经度</p>
					<div class="oneimp" style="width: 100%">
						<input type="text" id="lon" name="lon" class="imptxt" lay-verify="required"/>
					</div>
				</div>
				<div class="settingone" style="margin-bottom: 0;">
					<p class="oneitem-tit"><small>*</small>纬度</p>
					<div class="oneimp" style="width: 100%">
						<input type="text" id="lat" name="lat" class="imptxt" lay-verify="required"/>
					</div>
				</div>
				<div class="settingone" style="margin-bottom: 0;">
					<p class="oneitem-tit"><small>*</small>人口数</p>
					<div class="oneimp" style="width: 100%">
						<input type="text" id="pop" name="pop" class="imptxt" lay-verify="required"/>
					</div>
				</div>
				<div class="settingone" style="margin-bottom: 0;">
					<p class="oneitem-tit"><small>*</small>面积</p>
					<div class="oneimp" style="width: 100%">
						<input type="text" id="arer" name="arer" class="imptxt" lay-verify="required"/>
					</div>
				</div>
			</div>
		</div>
	</form>
</div>
<div class="gb-dialog gb-dialog-edit-area" style="display: none;">
	<form class="layui-form" action="">
		<div class="gb-dialog-main i">
			<h3 class="gb-dialog-title">
				<i class="iconfont icon-guanbi j-close-dialog"></i>
			</h3>
			<div style="width: 500px;height: 500px; padding: 0 15px;">
				<div class="settingone" style="margin-bottom: 0;">
					<p class="oneitem-tit"><small>*</small>上级单位</p>
					<div class="oneimp" style="width: 100%">
						<input type="text" readonly id="region" name="region" class="imptxt" id="citySel" lay-verify="required" onclick="showMenu();"/>
						<div id="menuContent" class="gb-tree scroll" style="display:none;bottom: auto!important;">
							<ul id="treeDemo" class="ztree"></ul>
						</div>
					</div>
				</div>
				<div class="settingone" style="margin-bottom: 0;">
					<p class="oneitem-tit"><small>*</small>地区名</p>
					<div class="oneimp" style="width: 100%">
						<input type="text" id="regionName" name="regionName" class="imptxt" lay-verify="required"/>
					</div>
				</div>
				<div class="settingone" style="margin-bottom: 0;">
					<p class="oneitem-tit"><small>*</small>经度</p>
					<div class="oneimp" style="width: 100%">
						<input type="text" id="lon" name="lon" class="imptxt" lay-verify="required"/>
					</div>
				</div>
				<div class="settingone" style="margin-bottom: 0;">
					<p class="oneitem-tit"><small>*</small>纬度</p>
					<div class="oneimp" style="width: 100%">
						<input type="text" id="lat" name="lat" class="imptxt" lay-verify="required"/>
					</div>
				</div>
				<div class="settingone" style="margin-bottom: 0;">
					<p class="oneitem-tit"><small>*</small>人口数</p>
					<div class="oneimp" style="width: 100%">
						<input type="text" id="pop" name="pop" class="imptxt" lay-verify="required"/>
					</div>
				</div>
				<div class="settingone" style="margin-bottom: 0;">
					<p class="oneitem-tit"><small>*</small>面积</p>
					<div class="oneimp" style="width: 100%">
						<input type="text" id="arer" name="arer" class="imptxt" lay-verify="required"/>
					</div>
				</div>
			</div>
		</div>
	</form>
</div>

<script type="text/javascript">
	portVar={
		ajaxUrlDelete:portsrc + '/res/platform/delete',
		type:'',
	};
	
	layui.use(['form','element'], function(){
		var element = layui.element,form = layui.form;
		form.render();
		var itbtn = $('<span class="itbtn"></span>');
		$('.layui-select-title').append(itbtn);
		$('.gb-form .layui-form-radio').remove();
		//触发事件
		var active = {
		    loading: function(othis){
		      var DISABLED = 'layui-btn-disabled';
		      if(othis.hasClass(DISABLED)) return;
		      
		      //模拟loading
		      var n = 0,timer = setInterval(function(){
		        n = n + Math.random()*10|0;  
		        if(n>100){
		          n = 100;
		          clearInterval(timer);
		          othis.removeClass(DISABLED);
		          $('.leadiv .layui-progress').hide();
		          $('.leadhint').hide();
		          $('.leadiv .succmat').show();
		        }
		        element.progress('demo', n+'%');
		      }, 300+Math.random()*1000);
		      
		      othis.addClass(DISABLED);
		    }
		};
	  
		$('.leadin').change(function(){
			$('.leadiv .succmat').hide();
			$('.leadiv .layui-progress').show();
		    $('.leadhint').show();
			$('.popnone').show();
			$('.tolead').show();

			var othis = $(this), type = $(this).data('type');
			active[type] ? active[type].call(this, othis) : '';
		})
	});
    var table = $('#table-main table').DataTable({
        "scrollY": "calc(100% - 50px)",
	    "scrollX": true,
        "dom": '<"top"f >rt<"bottom"ilp><"clear">',//dom定位
        "dom": 'tiprl',//自定义显示项
        "lengthMenu":[10, 20, 30, 40, 50],//每页显示条数设置
        "lengthChange": true,//是否允许用户自定义显示数量
        "bPaginate": true, //翻页功能
        "bFilter": true, //列筛序功能
        "searching": true,//本地搜索
        "order": [ 1, "asc" ],//desc降序
        "Info": true,//页脚信息
        "oLanguage": oLanguage,
        "ajax": {
            url: portsrc+'/res/platform/all',
			type: 'post',
			data:{
            	token:token,
            	confirm:true,//true确认,false未确认
            	status:0,//可以0-全部，1-正常，2-异常
			},
            dataSrc: function ( data ) {
            	console.log(data)
            	if(data.body!=null){
	                for ( var i=0, ien=data.body.length ; i<ien ; i++ ) {
	                	var d=data.body[i];
	                	data.body[i].checkbox="<div class='checkone'><input type='checkbox' name='checkone' id='"+d.id+"' /><label for='"+d.id+"'></label></div>";//复选框
	                	data.body[i].tabnumb="<span class='tabnumb'>"+(d.id+1)+"</span>";//序号

	                	data.body[i].state='<span class="statecol">'+d.state+'</span>';
	                	
	                	data.body[i].time="无";
	                	data.body[i].platformName="<a href='#/viewPlatResoInfo' url='components/viewPlatResoInfo.html' class='view-cont add_tab' name='查看平台资源信息'>"+d.platformName+"</a>";
	                	data.body[i].edit="<a href='#/editPlatResoInfo' url='components/editPlatResoInfo.html' class='editbtn add_tab' name='编辑平台资源信息'><i class='iconfont icon-bianji'></i>编辑</a>"
	                	data.body[i].delete="<span class='del delete'><i class='iconfont icon-shanchu'></i>删除</span>";
	                }
                	return data.body;
                }else{
                	return [];
                }
            }
        },
		"columns": [
		    { "data": "checkbox" },
		    { "data": "tabnumb" },
		    { "data": "resourceCode" },
		    { "data": "status" },
		    { "data": "platformType" },
		    { "data": "systemType" },
		    { "data": "platformName" },
		    { "data": "ipAddress" },
		    { "data": "areaStruct" },
		    { "data": "time" },
		    { "data": "edit" },
		    { "data": "delete" }
		],
        "columnDefs": [
        		{
                orderable: false,
                targets: [0,2,3,4,5,6,7,8,10,11] //禁止排序
            }
        ],
        fnDrawCallback: function(table) {  
        	jumpPage($("#table-main"))
        },
        initComplete: function () {//列筛选
            var api = this.api();
            api.columns().indexes().flatten().each(function (i) {
                if (i == 3 || i == 4 || i == 5 || i == 8) { // 对第i列进行筛选
                    var column = api.column(i);
		 				rowScreen(column);
                }
            });
        }
	});
	userDef(table);//table配置--显示数量 搜索 全选 删除 

    // 树配置
	var resourceSetting = {
		view:{
			showLine:false,//去掉连接线
			addDiyDom:resourceDom
		},
		callback: {
			onClick: editResourceClick
		}
	};
	function addResourceClick(e,treeId, treeNode) {
		layui.use(['form','element'], function(){
			var element = layui.element,form = layui.form;
			layer.open({
				type: 1, 
				title:false,
				shadeClose:true,
				closeBtn: 0,
				content: $(".gb-dialog-add-area"),
				btn: ['确定','取消'],
				yes: function(index, layero){
					var data={};
					data.region=$('#region').val();
					data.regionName=$('#regionName').val();
					data.lon=$('#lon').val();
					data.lat=$('#lat').val();
					data.pop=$('#pop').val();
					data.arer=$('#arer').val();
					// $.ajax({
					//     url: portsrc+"/msg/Platform/add",
					//     type: 'post',
					//     dataType: 'json',
					//     data:{
					//     	token:token,
					//     },
					//     success: function(data) {
					//     }
					// });
					layer.closeAll();
				},
				success: function(layero, index){
					
				}
			});
		});
	};
	function editResourceClick(e,treeId, treeNode) {
		layui.use(['form','element'], function(){
			var element = layui.element,form = layui.form;
			layer.open({
				type: 1, 
				title:false,
				shadeClose:true,
				closeBtn: 0,
				content: $(".gb-dialog-edit-area"),
				btn: ['修改','取消','删除'],
				yes: function(index, layero){
					var data={};
					data.region=$('#region').val();
					data.regionName=$('#regionName').val();
					data.lon=$('#lon').val();
					data.lat=$('#lat').val();
					data.pop=$('#pop').val();
					data.arer=$('#arer').val();
					// $.ajax({
					//     url: portsrc+"/msg/Platform/add",
					//     type: 'post',
					//     dataType: 'json',
					//     data:{
					//     	token:token,
					//     },
					//     success: function(data) {
					//     }
					// });
					layer.closeAll();
				},
				success: function(layero, index){
					
				}
			});
		});
	};
	var treeadd = 'newPlatResoInfo',treedit = 'editPlatResoInfo',resourceData;
	creatTree(treeadd);
	function creatTree(treeadd){
		// 树数据
		resourceData=[{
		    name: "浙江省",
		    open: true,
		    children: [{
		        name: "杭州市",
		        children: [{
			        name: "上城区",
			        children: [{
				        name: "湖滨街道",
				    }]
			    }]
		    }]
		}];

		//初始化的树
		$(".ztree-resource").each(function() {
			$.fn.zTree.init($(this), resourceSetting, resourceData);
		});
	}

</script>