<div class="gb-form">
	<form class="layui-form" action="">
		<div class="newform">
			<p class="newform-tit"><i class="iconfont icon-renwutiaoduchuangjian"></i>新建调度方案</p>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit"><span class="onenumb">01</span><small>*</small>事件类别</p>
				</div>
				<div class="oneitem-cont j-event">
					<p class="oneitem-tit"><small>*</small>选择事件类别</p>
					<div class="layui-input-inline">
						<select name="type" lay-search="" lay-verify="required"> 
							<option value="">请选择事件类别</option>
						</select>
					</div>
				</div>
			</div>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit"><span class="onenumb">02</span><small>*</small>事件名称</p>
				</div>
				<div class="oneitem-cont">
					<p class="oneitem-tit"><small>*</small>事件名称</p>
					<div class="oneimp">
						<input type="text" name="name" id="impcontent" class="imptxt" maxlength="20" lay-verify="required"/>
						<span class="oneimp-count"><span class="countnew">0</span>/20</span>
					</div>
				</div>
			</div>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit"><span class="onenumb">03</span><small>*</small>消息级别</p>
				</div>
				<div class="oneitem-cont">
					<p class="oneitem-tit"><small>*</small>消息级别</p>
					<ul class="msgrank">
						<li>
							<input type="radio" name="level" id="radone" value='RED' checked />
							<label for="radone"><img src="src/images/rank-red.png">红色</label>
						</li>
						<li>
							<input type="radio" name="level" id="radtwo" value='ORANGE' />
							<label for="radtwo"><img src="src/images/rank-orange.png">橙色</label>
						</li>
						<li>
							<input type="radio" name="level" id="radthr" value='YELLOW' />
							<label for="radthr"><img src="src/images/rank-yellow.png">黄色</label>
						</li>
						<li>
							<input type="radio" name="level" id="radfou" value='BLUE' />
							<label for="radfou"><img src="src/images/rank-blue.png">蓝色</label>
						</li>
						<li>
							<input type="radio" name="level" id="radfiv" value='GREEN' />
							<label for="radfiv"><img src="src/images/rank-green.png">绿色</label>
						</li>
					</ul>
				</div>
			</div>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit"><span class="onenumb">04</span><small>*</small>消息内容</p>
				</div>
				<div class="oneitem-cont">
					<p class="oneitem-tit"><small>*</small>消息内容</p>
					<div class="msgcont">
						<div class="txtimp">
							<textarea id="imparea" name="message" class="imparea" maxlength="200" placeholder="请输入消息文本"></textarea>
							<span class="area-count"><span class="countnew">0</span>/200</span>
						</div>
						<p class="itemexp"><i class="iconfont icon-iconfontjinggao"></i>文本内容可以直接转换成音频</p>
						<input type="button" value="转成音频" class="toswitch" />
					</div>
					<div class="filecont">
						<div class="filetit">
							<div class="filetit-one">
								<i class="iconfont icon-wushanguanwangziti-"></i>本地上传
							</div>
							<a href="#/characterVoice" url="components/characterVoice.html" name="文字语音" class="add_tab">		
								<span class="filetit-two"><i class="iconfont icon-kucun"></i>在应急音频资源库中选择</span>
							</a>
						</div>
						<ul class="filelist">
							<!-- <li>
								<div class="filename"><i class="iconfont icon-1"></i><span class="thename">文本.txt</span></div>
								<div class="filebtn">
									<input type="button" value="删除" class="filedel-btn"/>
									<input type="button" value="转换" class="fileconv-btn"/>
								</div>
							</li> -->
						</ul>
					</div>
				</div>
			</div>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit"><span class="onenumb">05</span><small>*</small>发生/覆盖地区</p>
				</div>
				<div class="oneitem-cont">
					<p class="oneitem-tit"><small>*</small>发生/覆盖地区</p>
					<div class="covarea-sel gb-tree-box left">
						<span class="systit"><i class="iconfont icon-xuanze"></i>已选择地区</span>
						<div class="gb-tree scroll">
							<ul id="gb_tree_areaSel" class="ztree ztree-close"></ul>
						</div>
					</div>
					<div class="covarea-all gb-tree-box right">
						<span class="systit"><i class="iconfont icon-quanbu"></i>全部地区</span>
						<div class="gb-tree scroll">
							<ul id="gb_tree_area" class="ztree ztree-check"></ul>
						</div>
					</div>
				</div>
			</div>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit"><span class="onenumb">06</span><small>*</small>调用系统资源</p>
				</div>
				<div class="oneitem-cont">
					<p class="oneitem-tit"><small>*</small>可调用系统资源</p>
					<div class="sysreso-sel gb-tree-box left">
						<span class="systit"><i class="iconfont icon-xuanze"></i>已选择资源</span>
						<div class="gb-tree scroll">
							<ul id="gb_tree_resourceSel" class="ztree ztree-close"></ul>
						</div>
					</div>
					<div class="sysreso-all gb-tree-box right">
						<span class="systit"><i class="iconfont icon-quanbu"></i>全部资源</span>
						<div class="gb-tree scroll">
							<ul id="gb_tree_resource" class="ztree ztree-check"></ul>
						</div>
					</div>
				</div>
			</div>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit"><span class="onenumb">07</span>预覆盖人数/预覆盖面积</p>
				</div>
				<div class="oneitem-cont" id="laytpl_dom">
					<div class="predictone">
						<p class="oneitem-tit">预覆盖人数</p>
						<p class="precount"><i class="j-peopleAffect">0</i>万人</p>
					</div>
					<div class="predictwo">
						<p class="oneitem-tit">预覆盖面积</p>
						<p class="precount"><i class="j-coverArea">0</i>平方公里</p>
					</div>
				</div>
			</div>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit"><span class="onenumb">08</span>发布部门/负责人</p>
				</div>
				<div class="oneitem-cont">
					<div class="predictone">
						<div class="oneitem-cont j-inpSel j-department">
							<p class="oneitem-tit">发布部门</p>
							<div class="layui-input-inline">
								<select name="department" > 
									<option value="">发布部门</option>
								</select>
							</div>
						</div>
					</div>
					<div class="predictwo">
						<div class="oneitem-cont j-inpSel j-dutyPerson">
							<p class="oneitem-tit">负责人</p>
							<div class="layui-input-inline">
								<select name="dutyPerson" > 
									<option value="">负责人</option>
								</select>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit"><span class="onenumb">09</span><small>*</small>直接发布</p>
				</div>
				<div class="oneitem-cont">
					<p class="oneitem-tit"><small>*</small>直接发布</p>
					<ul class="msgrank">
						<li>
							<input type="radio" name="direct" id="cheone" value='true' checked />
							<label for="cheone">是</label>
						</li>
						<li>
							<input type="radio" name="direct" id="chetwo" value='false' />
							<label for="chetwo">否</label>
						</li>
					</ul>
				</div>
			</div>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit"><span class="onenumb">10</span><small>*</small>时间范围</p>
				</div>
				<div class="oneitem-cont">
					<div class="layui-input-inline">
						<input type="text" class="layui-input" name="time" id="daterg" placeholder="选择时间范围" lay-verify="required">
						<span class="tocho iconfont icon-shijian" id="tochobtn"></span> 
					</div>
				</div>
			</div>
			<div class="tocreat">
				<input type="button" value="确定" class="tocreatbtn" lay-submit lay-filter="*" />
			</div>
			<p class="botword">© 2017-2018 浙江省应急广播平台</p>
		</div>
		<div class="popwindow"></div>
		<div class="choose">
			<p class="choword">确定删除此任务消息吗？</p>
			<div class="chobtn">
				<input type="button" value="删除" class="chopri cho-delete" />
				<input type="button" value="取消" class="cho-cancel" />
			</div>
			<span class="triangle"><em></em></span>
		</div>
		<div class="toshift">
			<p class="poptit">格式转换</p>
			<span class="popclose"><i class="iconfont icon-guanbi"></i></span>
			<div class="uncont">
				<div class="format">
					<span class="matit">当前格式：</span>
					<span class="themat">mp3</span>
				</div>
				<input type="file" accept="text/*" class="file_text" />
				<!-- <div class="format">
					<span class="matit">目标格式：</span>
					<div class="matchoose">
						<ul class="matlist">
							<li>
								<span class="matype">格式一</span>
								<div class="matcheck">
									<input type="radio" name="matcho" id="matone" checked="checked" />
									<label for="matone"></label>
								</div>
							</li>
							<li>
								<span class="matype">格式二</span>
								<div class="matcheck">
									<input type="radio" name="matcho" id="matwo" />
									<label for="matwo"></label>
								</div>
							</li>
							<li>
								<span class="matype">格式三</span>
								<div class="matcheck">
									<input type="radio" name="matcho" id="mathr" />
									<label for="mathr"></label>
								</div>
							</li>
							<li>
								<span class="matype">格式四</span>
								<div class="matcheck">
									<input type="radio" name="matcho" id="matfou" />
									<label for="matfou"></label>
								</div>
							</li>
							<li>
								<span class="matype">格式五</span>
								<div class="matcheck">
									<input type="radio" name="matcho" id="matfiv" />
									<label for="matfiv"></label>
								</div>
							</li>
							<li>
								<span class="matype">格式六</span>
								<div class="matcheck">
									<input type="radio" name="matcho" id="matsix" />
									<label for="matsix"></label>
								</div>
							</li>
						</ul>
					</div>
				</div> -->
				<div class="tomat">
					<div class="layui-progress layui-progress-big" lay-filter="demo"><!--  lay-showpercent="true" -->
						<div class="layui-progress-bar" lay-percent="0%"></div><!--   layui-bg-red -->
					</div>
					<p class="forword">转换中...</p>
				</div>
				<p class="succmat"><i class="iconfont icon-11"></i>转换成功！</p>
				<input type="button" value="转换" class="layui-btn site-demo-active" data-type="loading"/>
			</div>
		</div>
	</form>
</div>





<script type="text/javascript">
	// 获取事件类别接口
	$.ajax({
		url: portsrc+'/eventType',
		type: 'post',
		dataType: 'json',
		data:{
			token:token,
		},
		success: function(data) {
			console.log(data)
			var data=data.body;
			for (var i = 0; i < data.length; i++) {
				var name=data[i].code+data[i].name;
				$(".j-event .layui-input-inline select").append('<option value='+name+'>'+name+'</option>');
			};
			$.ajax({
				url: portsrc + '/users/all',
				type: 'get',
				data: {
					token: token,
				},
				success:function (data) {
					var data=data.body;
					for (var i = 0; i < data.length; i++) {
						var name=data[i].userName;
						$(".j-dutyPerson .layui-input-inline select").append('<option value='+name+'>'+name+'</option>');
					};
					$.ajax({
						url: portsrc+"/all/dep",
						type: 'post',
						data:{
							token:token,
						},
						success: function(data) {
							for (var i = 0; i < data.body.length; i++) {
								$(".j-department select").append('<option value='+data.body[i].id+'>'+data.body[i].name+'</option>');
							};

							layui.use(['form'], function(){
								var form = layui.form;
								form.render();
								var itbtn = $('<span class="itbtn"></span>');
								$('.layui-select-title').append(itbtn);
								$('.gb-form .layui-form-radio').remove();
								form.on('submit(*)', function(data){
									schedulingForm(data);
									data.field.department = $('.j-department .layui-input').val();
									data.field.dutyPerson = $('.j-dutyPerson .layui-input').val();
									$.ajax({
										url: portsrc+"/schedule/addItem",
										type: 'post',
										dataType: 'json',
										data:{
											token:token,
											planSchedule:JSON.stringify(data.field)
										},
										success: function(data){
											layer.open({
												title: '提示',
												shadeClose:false,
												content: '新建成功',
												yes: function(index, layero){
													window.location.href='#/schedulingPlan';
													layer.closeAll();
												}
											});
										}
									});
									return false; 
								});
								$('.j-inpSel .layui-input').removeAttr("readonly");
								$('.j-inpSel .layui-input').on('keyup',function () {
									var val = $(this).val();
									var dd = $(this).parents('.layui-select-title').siblings('.layui-anim-upbit').find('dd');
									dd.show();
									dd.each(function () {

										if ($(this).text().indexOf(val)<0) {
											$(this).hide()
										}
									})
								})
							});
						}
					})
						}
					})
				}
			});
	// 获取全部地区
	$.ajax({
		url: portsrc+'/allArea',
		type: 'post',
		dataType: 'json',
		data:{
			token:token,
		},
		success: function(data) {
			console.log(data)
			$.fn.zTree.init($('#gb_tree_area'), areaSetting, data.body);
		}
	});
</script>