<div class="gb-table">
	<div class="taskmsg" id="table-main">
		<div class="tkrange">
			<div class="tklay">
				<span class="talay-word"><i class="iconfont icon-rili"></i>发布时间</span>
				<div class="layui-input-inline">
			        <input type="text" class="layui-input" id="daterg" placeholder="选择时间范围">
			        <span class="tocho iconfont icon-shijian" id="tochobtn"></span> 
		    	</div>
		    	<a href="#/newTaskMsg" class="newtk-btn add_tab" url="components/newTaskMsg.html" name="新建任务消息">新建任务消息</a>
			</div>
			<div class="tksearch">
				<input type="text" value="请输入任务消息名称，发布部门，负责人" onfocus="if(this.value==defaultValue){this.value = '';this.style.color='#333'}" onblur="if(!value){this.value = defaultValue;this.style.color='#ccc';}" class="dsearch" aria-controls="table-main"/>
				<span class="tksrh-btn"><i class="iconfont icon-sousuo"></i></span>
			</div>
			<ul class="msgtype">
				<li class="msgact">已查阅</li>
				<li>未查阅</li>
				<li>新编辑</li>
			</ul>
		</div>
		<div class="thetab">
			<div class="tablecont">
			    <table class="table-main display" cellspacing="0" width="100%">
			        <thead>
				        <tr>
				        	<th></th>
				            <th>序号</th>
				            <th>状态监测</th>
				            <th>消息等级</th>
				            <th>任务消息名称</th>
				            <th>发布部门</th>
				            <th>负责人</th>
				            <th>发布时间</th>
				            <th>操作</th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				        </tr>
			        </thead>
			        <tfoot>
				        <tr>
							<th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				        </tr>
			        </tfoot>
			        <tbody id="table-html">
			        </tbody>
			    </table>
			</div>
			<div class="theche">
				<div class="tocheck">
					<input type="checkbox" name="checkall" id="checkAll" />
					<label for="checkAll">全选</label>
				</div>
				<span class="chedel j-del-tr"><i class="iconfont icon-shanchu"></i>删除</span>
			</div>
		</div>
		<p class="botword">© 2017-2018 浙江省应急广播平台</p>
	</div>
	

	<div class="popwindow"></div>
	<div class="preview">
		<p class="poptit">预览</p>
		<span class="popclose"><i class="iconfont icon-guanbi"></i></span>
		<div class="prevcont">
			<ul class="prevlist">
				<!-- <li>
					<p class="prevword">...</p>
					<input type="button" value="预览" class="tosee" />
				</li>
				<li>
					<p class="prevideo">视频.mp4</p>
					<input type="button" value="预览" class="tosee" />
				</li>
				<li>
					<p class="prevideo">文本.txt</p>
					<input type="button" value="预览" class="tosee" />
				</li> -->
			</ul>
			<!-- <input type="button" value="" /> -->
			<button class="seeall">
				<a href="#/newTaskMsgEdit" url="components/newTaskMsgEdit.html" class="add_tab" name="编辑任务消息">全部预览</a>
			</button>
			<input type="button" value="立即发布" class="seeall" style="margin-right: 10px;" />
		</div>
	</div>
	<div class="review">
		<p class="poptit">是否通过审核？</p>
		<span class="popclose"><i class="iconfont icon-guanbi"></i></span>
		<div class="revcont">
			<p class="revword">通过的任务消息将进入发布队列，您没有权限进行停止等操作。</p>
			<div class="revbtn">
				<input type="button" value="否" class="revno"/>
				<input type="button" value="是" class="revyes j-audit-yes"/>
			</div>
		</div>
	</div>
	<div class="fillin">
		<p class="poptit">请填写未通过原因！</p>
		<span class="popclose"><i class="iconfont icon-guanbi"></i></span>
		<div class="fillcnt">
			<script type="text/plain" id="myEditor" style="width:100%;height:164px;"></script>
			<div class="revbtn">
				<input type="button" value="取消" class="rev-cancel"/>
				<input type="button" value="确定" class="revyes j-audit-no"/>
			</div>
		</div>
	</div>
	<div class="unreason">
		<p class="poptit">未通过原因</p>
		<span class="popclose"><i class="iconfont icon-guanbi"></i></span>
		<div class="uncont">
			<p class="unword"></p>
			<input type="button" value="确定" class="un-confirm" />
		</div>
	</div>
	<div class="choose">
		<p class="choword">确定删除此任务消息吗？</p>
		<div class="chobtn">
			<input type="button" value="删除" class="chopri j-del-tr" />
			<input type="button" value="取消" class="cho-cancel" />
		</div>
		<span class="triangle"><em></em></span>
	</div>
</div>
	



<script type="text/javascript">
	portVar={
		ajaxUrlDelete:portsrc + '/msg/deleteMsg',//删除
		ajaxUrlReSend:portsrc + '/msg/taskMsg/reSend',//重播
		ajaxUrlUnpassreason:portsrc + '/unpassreason',//未通过原因
		ajaxUrlMessageAudit:portsrc + '/messageAudit',//审核是否通过
		type:'task',//类型
	};
	//富文本框
	var editorOption = {
	    scaleEnabled:true
	};
	var editor_a = new baidu.editor.ui.Editor(editorOption);
	editor_a.render('myEditor');
	/*table*/
	table = $('#table-main table').DataTable({
		"scrollY": "calc(100% - 50px)",
		"scrollX": true,
		"dom": '<"top"f >rt<"bottom"ilp><"clear">',//dom定位
		"dom": 'tiprl',//自定义显示项
		"lengthMenu":[10, 20, 30, 40, 50],//每页显示条数设置
		"lengthChange": true,//是否允许用户自定义显示数量
		"bPaginate": true, //翻页功能
		"bFilter": true, //列筛序功能
		"searching": true,//本地搜索
		"order": [ 1, "asc" ],//desc降序
		"Info": true,//页脚信息
		"oLanguage": oLanguage,
        "ajax": {
		    url: portsrc+'/msg/allMsg',
		    type: 'post',
		    data:{
		    	token:token,
		    	defaulrValue:0,
		    	type:'task'//task为任务消息，alert为预警消息
		    },
            dataSrc: function ( data ) {
                for ( var i=0, ien=data.body.length ; i<ien ; i++ ) {
                	var d=data.body[i];
                	data.body[i].checkbox="<div class='checkone'><input type='checkbox' name='checkone' id='"+d.id+"' /><label for='"+d.id+"'></label></div>";//复选框
                	data.body[i].tabnumb="<span class='tabnumb'>"+(d.id+1)+"</span>";//序号

                	var level="";
					if(d.level=="RED"){
						level="<img src='src/images/rank-red.png'/>";
					} else if(d.level=="BLUE"){
						level="<img src='src/images/rank-blue.png'/>";
					} else if(d.level=="GREEN"){
						level="<img src='src/images/rank-green.png'/>";
					} else if(d.level=="ORANGE"){
						level="<img src='src/images/rank-orange.png'/>";
					} else if(d.level=="YELLOW"){
						level="<img src='src/images/rank-yellow.png'/>";
					}
                	data.body[i].level='<span class="rankimg" vel="'+d.level+'">'+level+'</span>';

                	switch(d.status){
                		case 'CREATING':
                			data.body[i].status='已创建';
                			break;
                		case 'AUDITING':
                			data.body[i].status='已审核';
                			break;
                		case 'PUBLISHIING':
                			data.body[i].status='发布中';
                			break;
                		case 'RECEIPT':
                			data.body[i].status='收到回执';
                			break;
                		case 'FEEDBACK':
                			data.body[i].status='收到反馈';
                			break;
                		case 'FINISH':
                			data.body[i].status='发布结束';
                			break;
                		case 'CANCLE':
                			data.body[i].status='已取消';
                			break;
                		case 'SUSPEND':
                			data.body[i].status='暂停';
                			break;
                	}

                	data.body[i].name="<a href='#/viewTaskMsg' url='components/viewTaskMsg.html' class='view-cont add_tab' name='查看任务消息'>"+d.name+"</a>";
                	data.body[i].yulan="<span class='operbtn operbtnTask'><i class='iconfont icon-yulan'></i>预览</span>";
                	data.body[i].edit="<a href='#/newTaskMsgEdit' url='components/newTaskMsgEdit.html' class='editbtn add_tab' name='编辑任务消息'><i class='iconfont icon-bianji'></i>编辑</a>";
                	data.body[i].release="<a href='#/releasePolicy' class='issue isstr add_tab' url='components/releasePolicy.html' name='发布策略'><i class='iconfont icon-fabu'></i>发布策略</a>";

                	var audit="";
                	if(d.audit){
						if(d.audit.status=='UNAUDIT'){
							audit="<span class='check audit' lay-event='audit'><i class='iconfont icon-shenhe'></i>审核</span>";
						}else if(d.audit.status=='UNPASS'){
							audit="<span class='check notpass' lay-event='nopass'><i class='iconfont icon-weitongguo'></i>未通过</span>";
						}else if(d.audit.status=='PASS'){
							audit="<span class='check'>已通过</span>";
						}
					}
                	data.body[i].audit=audit;

                	var send="";
					if(d.send==0){
						send="<a href='javascript:void(0);' class='issue iscont'><i class='iconfont icon-bofang'></i>续发</a>";
					}else if(d.send==1){
						send='<a href="javascript:void(0);" class="issue isstop"><i class="iconfont icon-zanting"></i>停发</a>';
					}
                	data.body[i].send=send;

                	data.body[i].chretry="<span class='check chretry'><i class='iconfont icon-zhongbo'></i>重播</span>";
                	data.body[i].decancel="<span class='del decancel'><i class='iconfont icon-quxiao'></i>取消</span>";
                	data.body[i].delete="<span class='del delete'><i class='iconfont icon-shanchu'></i>删除</span>";
                }
                
                return data.body;
            }
        },
		"columns": [
		    { "data": "checkbox" },
		    { "data": "tabnumb" },
		    { "data": "status" },
		    { "data": "level" },
		    { "data": "name" },
		    { "data": "department" },
		    { "data": "dutyPerson" },
		    { "data": "pubTime" },
		    { "data": "yulan" },
		    { "data": "edit" },
		    { "data": "release" },
		    { "data": "audit" },
		    // { "data": "send" },
		    { "data": "chretry" },
		    { "data": "decancel" },
		    { "data": "delete" }
		],
		"columnDefs": [
			{
		       orderable: false,
		       targets: [0,3,4,5,8,9,10,11,12,13,14,15] //禁止排序
		    },{ 
		    	"sType": "html-percent", 
		       "aTargets": [3] //指定列号使用自定义排序
		    }
		],
		fnDrawCallback: function(table) {  
			jumpPage($("#table-main"))
		},
		initComplete: function () {//列筛选
		   var api = this.api();
		   api.columns().indexes().flatten().each(function (i) {
				var column = api.column(i);
		        if (i == 5) { //对第i列进行筛选
						rowScreen(column);
		        }else if (i==3) { //对第i列进行筛选
						rowLevScreen(column);
		        }
		   });
		}
	});
	userDef(table);//table配置--显示数量 搜索 全选 删除  

</script>