<div class="gb-table">
	<div class="taskmsg" id="table-main">
		<div class="tkrange">
			<div class="tklay">
				<span class="talay-word"><i class="iconfont icon-rili"></i>发布时间</span>
				<div class="layui-input-inline">
			        <input type="text" class="layui-input" id="daterg" placeholder="选择时间范围">
			        <span class="tocho iconfont icon-shijian" id="tochobtn"></span> 
		    	</div>
		    	<a href="#/newTaskMsg" class="newtk-btn add_tab" url="components/newTaskMsg.html" name="新建任务消息">新建任务消息</a>
			</div>
			<div class="tksearch">
				<input type="text" value="请输入任务消息名称，发布部门，负责人" onfocus="if(this.value==defaultValue){this.value = '';this.style.color='#333'}" onblur="if(!value){this.value = defaultValue;this.style.color='#ccc';}" class="dsearch" aria-controls="table-main"/>
				<span class="tksrh-btn"><i class="iconfont icon-sousuo"></i></span>
			</div>
			<ul class="msgtype">
				<li class="msgact">已查阅</li>
				<li>未查阅</li>
				<li>新编辑</li>
			</ul>
		</div>
		<div class="thetab">
			<div class="tablecont">
			    <table class="table-main display" cellspacing="0" width="100%">
			        <thead>
				        <tr>
				        	<th></th>
				            <th>序号</th>
				            <th>状态监测</th>
				            <th>消息等级</th>
				            <th>任务消息名称</th>
				            <th>发布部门</th>
				            <th>负责人</th>
				            <th>发布时间</th>
				            <th>操作</th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				        </tr>
			        </thead>
			        <tfoot>
				        <tr>
							<th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				            <th></th>
				        </tr>
			        </tfoot>
			        <tbody id="table-html">
			        </tbody>
			    </table>
			</div>
			<div class="theche">
				<div class="tocheck">
					<input type="checkbox" name="checkall" id="checkAll" />
					<label for="checkAll">全选</label>
				</div>
				<span class="chedel"><i class="iconfont icon-shanchu"></i>删除</span>
			</div>
		</div>
		<p class="botword">© 2017-2018 浙江省应急广播平台</p>
	</div>
	

	<div class="popwindow"></div>
	<div class="preview">
		<p class="poptit">预览</p>
		<span class="popclose"><i class="iconfont icon-guanbi"></i></span>
		<div class="prevcont">
			<ul class="prevlist">
				<li>
					<p class="prevword">文本信息文本信息文本信息文本信息文本信息文本信息文本信息文本信息文本信息文本信息文本信息文本信息文本信息文本信息文本信息文本信息文本信息文本信息文本信息文本信息...</p>
					<input type="button" value="预览" class="tosee" />
				</li>
				<li>
					<p class="prevideo">视频.mp4</p>
					<input type="button" value="预览" class="tosee" />
				</li>
				<li>
					<p class="prevideo">文本.txt</p>
					<input type="button" value="预览" class="tosee" />
				</li>
			</ul>
			<input type="button" value="全部预览" class="seeall" />
		</div>
	</div>
	<div class="review">
		<p class="poptit">是否通过审核？</p>
		<span class="popclose"><i class="iconfont icon-guanbi"></i></span>
		<div class="revcont">
			<p class="revword">通过的任务消息将进入发布队列，您没有权限进行停止等操作。</p>
			<div class="revbtn">
				<input type="button" value="否" class="revno"/>
				<input type="button" value="是" class="revyes"/>
			</div>
		</div>
	</div>
	<div class="fillin">
		<p class="poptit">请填写未通过原因！</p>
		<span class="popclose"><i class="iconfont icon-guanbi"></i></span>
		<div class="fillcnt">
			<script type="text/plain" id="myEditor" style="width:100%;height:164px;"></script>
			<div class="revbtn">
				<input type="button" value="取消" class="rev-cancel"/>
				<input type="button" value="确定" class="revyes"/>
			</div>
		</div>
	</div>
	<div class="unreason">
		<p class="poptit">未通过原因</p>
		<span class="popclose"><i class="iconfont icon-guanbi"></i></span>
		<div class="uncont">
			<p class="unword">未通过原因未通过原因未通过原因未通过原因未通过原因未通过原因未通过原因未通过原因未通过原因未通过原因未通过原因未通过原因未通过原因未通过原因未通过原因未通过原因未通过原因未通过原因未通过原因</p>
			<input type="button" value="确定" class="un-confirm" />
		</div>
	</div>
	<div class="choose">
		<p class="choword">确定删除此任务消息吗？</p>
		<div class="chobtn">
			<input type="button" value="删除" class="chopri cho-delete" />
			<input type="button" value="取消" class="cho-cancel" />
		</div>
		<span class="triangle"><em></em></span>
	</div>
</div>
	



<script type="text/javascript">
var table;
	$(document).ready(function(){
		// 模拟数据
		$.ajax({
		    url: portsrc+'/msg/allMsg',
		    type: 'get',
		    dataType: 'json',
		    data:{
		    	token:token,
		    	type:'task'
		    },
		    success: function(data) {
		    	console.log(data)
				layui.use('laytpl', function(){
					var laytpl = layui.laytpl;
					var getTpl = tableHtml.innerHTML,
					    tableH = document.getElementById('table-html');
					laytpl(getTpl).render(data, function(html) {
					    tableH.innerHTML = html;
					    table_fun()
					});
				});
		    }
		});
		function table_fun() {
			//富文本框
			var editorOption = {
			    scaleEnabled:true
			};
			var editor_a = new baidu.editor.ui.Editor(editorOption);
			editor_a.render('myEditor');
			/*table*/
			table = $('#table-main table').DataTable({
				"scrollY": "calc(100% - 50px)",
				"scrollX": true,
				"dom": '<"top"f >rt<"bottom"ilp><"clear">',//dom定位
				"dom": 'tiprl',//自定义显示项
				"lengthMenu":[10, 20, 30, 40, 50],//每页显示条数设置
				"lengthChange": true,//是否允许用户自定义显示数量
				"bPaginate": true, //翻页功能
				"bFilter": true, //列筛序功能
				"searching": true,//本地搜索
				"order": [ 1, "asc" ],//desc降序
				"Info": true,//页脚信息
				/*"processing": true,//引用json文件
				"ajax": "data/table.json",
				"columns": [
				    { "data": "checkbox" },
				    { "data": "sernumb" },
				    { "data": "condmon" },
				    { "data": "rank" },
				    { "data": "msgname" },
				    { "data": "pubdep" },
				    { "data": "principal" },
				    { "data": "reletime" },
				    { "data": "operate" },
				    { "data": "edit" },
				    { "data": "issue" },
				    { "data": "check" },
				    { "data": "del" }
				],*/
				"oLanguage": oLanguage,
				"columnDefs": [
						{
				       orderable: false,
				       targets: [0,3,4,5,8,9,10,11,12,13,14,15] //禁止排序
				    },{ 
				    	"sType": "html-percent", 
				       "aTargets": [3] //指定列号使用自定义排序
				    } 
				],
				fnDrawCallback: function(table) {  
					jumpPage($("#table-main"))
				},
				initComplete: function () {//列筛选
				   var api = this.api();
				   api.columns().indexes().flatten().each(function (i) {
						var column = api.column(i);
				        if (i == 5) { //对第i列进行筛选
								rowScreen(column);
				        }else if (i==3) { //对第i列进行筛选
								rowLevScreen(column);
				        }
				   });
				}
			})
			userDef(table);//table配置--显示数量 搜索 全选 删除  
		};
	})

	
</script>
<!-- js模板引擎 -->
<script id="tableHtml" type="text/html">
  {{#  layui.each(d.body, function(index, item){ }}
  	<tr>
		<td><div class='checkone'><input type='checkbox' name='checkone' id={{item.id}} /><label for={{item.id}}></label></div></td>
		<td><span class='tabnumb'>{{item.id+1}}</span></td>
		<td>{{item.state}}</td>
		<td>
			<span class='rankimg' vel={{item.level}}>
				{{#  if(item.level=="红色"){ }}
					<img src='src/images/rank-red.png'/>
				{{#  } else if(item.level=="蓝色"){ }}
					<img src='src/images/rank-blue.png'/>
				{{#  } else if(item.level=="绿色"){ }}
					<img src='src/images/rank-green.png'/>
				{{#  } else if(item.level=="橙色"){ }}
					<img src='src/images/rank-orange.png'/>
				{{#  } else if(item.level=="黄色"){ }}
					<img src='src/images/rank-yellow.png'/>
				{{#  } }}
			</span>
		</td>
		<td><a href='#/viewTaskMsg' url='components/viewTaskMsg.html' class='view-cont add_tab' name='查看任务消息'>{{item.name}}</a></td>
		<td>{{item.department}}</td>
		<td>{{item.people}}</td>
		<td>{{item.time}}</td>
		<td><span class='operbtn'><i class='iconfont icon-yulan'></i>预览</span></td>
		<td><a href='#/newTaskMsgEdit' url='components/newTaskMsgEdit.html' class='editbtn add_tab' name='编辑任务消息'><i class='iconfont icon-bianji'></i>编辑</a></td>
		<td><a href='#/releasePolicy' class='issue isstr add_tab' url='components/releasePolicy.html' name='发布策略'><i class='iconfont icon-fabu'></i>发布策略</a></td>
		<td>
			{{#  if(item.audit.boolean==true){ }}
				{{# if(item.audit.state=='审核'){ }}
					<span class='check audit' lay-event='audit'><i class='iconfont icon-shenhe'></i>审核</span>
				{{#  } else if(item.audit.state=='未通过'){ }}
					<span class='check notpass' lay-event='nopass'><i class='iconfont icon-weitongguo'></i>未通过</span>
				{{#  } }}
			{{#  } else if(item.audit.boolean==false){ }}
				
			{{#  } }}
		</td>
		<td>
			{{#  if(item.send.boolean==true){ }}
				{{# if(item.send.state=='续发'){ }}
					<a href='javascript:void(0);' class='issue iscont'><i class='iconfont icon-bofang'></i>续发</a>
				{{#  } else if(item.send.state=='停发'){ }}
					<a href="javascript:void(0);" class="issue isstop"><i class="iconfont icon-zanting"></i>停发</a>
				{{#  } }}
			{{#  } else if(item.send.boolean==false){ }}
				
			{{#  } }}
		</td>
		<td><span class='check chretry'><i class='iconfont icon-zhongbo'></i>重发</span></td>
		<td><span class='del decancel'><i class='iconfont icon-quxiao'></i>取消</span></td>
		<td><span class='del delete'><i class='iconfont icon-shanchu'></i>删除</span></td>
	</tr>
  {{#  }); }}
  {{#  if(d.body === 0){ }}
    无数据
  {{#  } }}
</script>