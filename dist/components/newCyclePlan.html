<div class="gb-form">
	<form class="layui-form" action="">
		<div class="newform">
			<p class="newform-tit"><i class="iconfont icon-iconfontxinjianwenjian"></i>新建周期计划</p>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit"><span class="onenumb">01</span><small>*</small>周期计划名称</p>
				</div>
				<div class="oneitem-cont">
					<p class="oneitem-tit"><small>*</small>周期计划名称</p>
					<div class="oneimp">
						<input type="text" name="name" id="impcontent" class="imptxt" maxlength="20" lay-verify="required"/>
						<span class="oneimp-count"><span class="countnew">0</span>/20</span>
					</div>
				</div>
			</div>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit"><span class="onenumb">02</span><small>*</small>周期</p>
				</div>
				<div class="oneitem-cont">
					<p class="oneitem-tit"><small>*</small>选择周期类型</p>
					<div class="layui-input-inline">
						<select name="cycle" lay-search="" lay-filter="period" lay-verify="required" id="cycle">
							<option value="">请选择周期类型</option>
							<option value="0">每天</option>
							<option value="1">每周</option>
							<option value="2">每月</option>
							<option value="3">每年</option>
						</select>
					</div>
				</div>
			</div>
			<div class="form-oneitem">
				<div class="fortit">
					<p class="oneitem-tit"><span class="onenumb">03</span><small>*</small>调度方案</p>
				</div>
				<div class="oneitem-cont">
					<p class="oneitem-tit"><small>*</small>选择调度方案</p>
					<div class="layui-input-inline j-scheduling-sel">
						<select name="schedulePlanId" lay-search="" lay-filter="scheduling_sel" lay-verify="required">
							<option value="">请选择调度方案</option>
						</select>
					</div>
					<p class="itemexp"><i class="iconfont icon-iconfontjinggao"></i>选择调度方案后，后面的信息将自动匹配为预设的事件信息并且不能修改</p>
				</div>
			</div>
			<div class="form-oneitem-box" style="display: none;">
				<div class="form-oneitem">
					<div class="fortit">
						<p class="oneitem-tit"><span class="onenumb">03</span><small>*</small>事件类型</p>
					</div>
					<div class="oneitem-cont">
						<p class="oneitem-tit"><small>*</small>事件类别</p>
						<div class="tnoneimp">
							<input type="text" class="imptxt j-type" readonly="readonly"/>
						</div>
					</div>
				</div>
				<div class="form-oneitem">
					<div class="fortit">
						<p class="oneitem-tit"><span class="onenumb">04</span><small>*</small>消息级别</p>
					</div>
					<div class="oneitem-cont">
						<p class="oneitem-tit"><small>*</small>消息级别</p>
						<div class="tnoneimp">
							<input type="text" class="imptxt j-level" readonly="readonly"/>
						</div>
					</div>
				</div>
				<div class="form-oneitem">
					<div class="fortit">
						<p class="oneitem-tit"><span class="onenumb">05</span><small>*</small>消息内容</p>
					</div>
					<div class="oneitem-cont">
						<p class="oneitem-tit"><small>*</small>消息内容</p>
						<div class="msgcont">
							<ul class="filelist">
							</ul>
						</div>
					</div>
				</div>
				<div class="form-oneitem">
					<div class="fortit">
						<p class="oneitem-tit"><span class="onenumb">06</span><small>*</small>覆盖范围</p>
					</div>
					<div class="oneitem-cont">
						<p class="oneitem-tit"><small>*</small>覆盖范围</p>
						<div class="covarea-sel gb-tree-box left">
							<!-- <span class="systit"><i class="iconfont icon-xuanze"></i>已选择地区</span> -->
							<div class="gb-tree scroll">
								<ul id="gb_tree_areaSel" class="ztree ztree-close"></ul>
							</div>
						</div>
					</div>
				</div>
				<div class="form-oneitem">
					<div class="fortit">
						<p class="oneitem-tit"><span class="onenumb">07</span><small>*</small>调用系统资源</p>
					</div>
					<div class="oneitem-cont">
						<p class="oneitem-tit"><small>*</small>调用系统资源</p>
						<div class="sysreso-sel gb-tree-box left">
							<!-- <span class="systit"><i class="iconfont icon-xuanze"></i>已选择资源</span> -->
							<div class="gb-tree scroll">
								<ul id="gb_tree_resourceSel" class="ztree ztree-close"></ul>
							</div>
						</div>
					</div>
				</div>
				<div class="form-oneitem">
					<div class="fortit">
						<p class="oneitem-tit"><span class="onenumb">08</span>预覆盖人数/预覆盖面积</p>
					</div>
					<div class="oneitem-cont">
						<div class="predictone">
							<p class="oneitem-tit">预覆盖人数</p>
							<p class="precount"><i class="j-peopleAffect">0</i>万人</p>
						</div>
						<div class="predictwo">
							<p class="oneitem-tit">预覆盖面积</p>
							<p class="precount"><i class="j-coverArea">0</i>平方公里</p>
						</div>
					</div>
				</div>
				<div class="form-oneitem">
					<div class="fortit">
						<p class="oneitem-tit"><span class="onenumb">09</span>发布部门/负责人</p>
					</div>
					<div class="oneitem-cont">
						<div class="predictone">
							<p class="oneitem-tit">发布部门</p>
							<p class="precount j-department"></p>
						</div>
						<div class="predictwo">
							<p class="oneitem-tit">负责人</p>
							<p class="precount j-dutyPerson"></p>
						</div>
					</div>
				</div>
			</div>
			<div class="tocreat crepad">
				<div class="progcreat">
					<input type="button" value="确认创建" class="tocreatbtn" lay-submit lay-filter="*" />
				</div>
				<p class="warnword"><i class="iconfont icon-iconfontjinggao"></i>成功创建后，需编写对应的发布策略后，方能提交审核</p>
			</div>
			<p class="botword">© 2017-2018 浙江省应急广播平台</p>
		</div>
		<div class="popwindow"></div>
		<div class="datecho">
			<div class="layui-input-inline">
				<input type="text" class="layui-input" id="thedate" placeholder="请选择时间">
			</div>
			<p class="gb-line"></p>
			<div class="theday">
				<span class="daywrod">间隔：</span>
				<div class="layui-input-inline">
					<select lay-search="" lay-filter="theday">
						<option value=""></option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
					</select>
				</div>
				<span class="daywrod">天</span>
			</div>
			<p class="repeat"><span class="repcho">每天</span>重复</p>
			<input type="button" value="确定" class="un-confirm" />
		</div>
		<div class="weekcho">
			<div class="layui-input-inline">
				<input type="text" class="layui-input" id="weekday" placeholder="请选择时间">
			</div>
			<p class="gb-line"></p>
			<div class="theday">
				<span class="daywrod">间隔：</span>
				<div class="layui-input-inline">
					<select lay-search="" lay-filter="weekday">
						<option value=""></option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
					</select>
				</div>
				<span class="daywrod">周</span>
			</div>
			<ul class="weeklist">
				<li>一</li>
				<li>二</li>
				<li>三</li>
				<li>四</li>
				<li>五</li>
				<li>六</li>
				<li>日</li>
			</ul>
			<p class="repeat"><span class="repcho">每周</span>重复</p>
			<input type="button" value="确定" class="un-confirm" />
		</div>
		<div class="yemon">
			<p class="poptit"></p>
			<span class="popclose"><i class="iconfont icon-guanbi"></i></span>
			<div class="monthcho">
				<div class="daytime">
					<div class="layui-input-inline layshow" id="monday">
						<input type="text" class="layui-input" id="dayinp" placeholder="请选择日期">
					</div>
					<div class="layui-input-inline" id="montime">
						<input type="text" class="layui-input" id="timeinp" placeholder="请选择时间">
					</div>
				</div>
			</div>
		</div>
	</form>
</div>





<script type="text/javascript">
	$(document).ready(function(){
		var dayarr = ['每天','每两天','每三天','每四天','每五天','每六天'],
		weekarr = ['每周','每两周','每三周','每四周','每五周','每六周'];
		$.ajax({
			url: portsrc+'/schedule/allItem',
			type: 'post',
			dataType: 'json',
			data:{
				token:token,
			},
			success: function(data) {
				console.log(data)
				var data=data.body;
				for (var i = 0; i < data.length; i++) {
					$(".j-scheduling-sel select").append('<option value='+data[i].id+'>'+data[i].name+'</option>');
				};
				layui.use(['form', 'element'], function(){
					var element = layui.element,form = layui.form,laydate = layui.laydate;
					form.render();
					var itbtn = $('<span class="itbtn"></span>');
					$('.layui-select-title').append(itbtn);
					$('.gb-form .layui-form-radio').remove();

					laydate.render({
						elem: '#thedate',
						type: 'time'
					});
					laydate.render({
						elem: '#weekday',
						type: 'time'
					});
					laydate.render({
						elem: '#monday',
						position: 'static',
						done: function(value, date) {
							//console.log('你选择的日期是：' + value);
							$('#dayinp').val(value);
						}
					});
					laydate.render({
						elem: '#montime',
						type: 'time',
						position: 'static',
						done: function(value, date) {
							//console.log('你选择的时间是：' + value);
							$('#timeinp').val(value);
						}
					});

					// form.on('select(period)', function(data) {
					// 	//console.log(data.value); //得到被选中的值
					// 	var selnumb = data.value;
					// 	if (selnumb == 0) {
					// 		$('.popwindow').show();
					// 		$('.datecho').show();
					// 	} else if (selnumb == 1) {
					// 		$('.popwindow').show();
					// 		$('.weekcho').show();
					// 	} else if (selnumb == 2 || selnumb == 3) {
					// 		$('.popwindow').show();
					// 		$('.yemon').show();
					// 	}
					// });

					// form.on('select(theday)', function(data) {
					// 	var selnumb = data.value - 1;
					// 	$('.datecho .repcho').html(dayarr[selnumb]);
					// });

					// form.on('select(weekday)', function(data) {
					// 	var selnumb = data.value - 1;
					// 	$('.weekcho .repcho').html(weekarr[selnumb]);
					// });

					// 选择调度方案
					form.on('select(scheduling_sel)', function(data){
						if(data.value!=""){
							$(".form-oneitem-box").show();
							// 获取编辑数据
							$.ajax({
								url: portsrc+'/schedule/getItem',
								type: 'post',
								dataType: 'json',
								data:{
									token:token,
									id:data.value,
								},
								success: function(data) {
									console.log(data)
									var data=data.body;
						    		$(".j-type").val(data.type);//默认事件类别
							    	$(".j-name").val(data.name);//默认事件名
							    	$(".j-level").val(data.level);//默认事件等级
							    	$(".filelist li").remove();
							    	for (var i = 0; i < data.listMP3.length; i++) {
							    		audio_add_html(data.listMP3[i]);//添加一条音频数据
							    		$(".filedel-btn").remove();
							    	};
							    	$(".j-peopleAffect").text(data.peopleAffect);//覆盖人数
							    	$(".j-coverArea").text(data.area);//覆盖面积
							    	$(".j-department").text(data.department);//部门
							    	$(".j-dutyPerson").text(data.dutyPerson);//责任人
							    	
							    	$(".release-radio li").each(function(index, el) {
							    		if($(this).find('input').val()==data.direct){
							    			$(this).find('input').attr('checked','checked')
							    		}
							    	});//默认是否发布
							    	laydate.render({ 
							    		elem: '#datergs',
							    		eventElem: '#tochobtn',
							    		trigger: 'click',
							    		type:'datetime',
							    		range: true,
							    		value: data.time
							    	});
							    	$.fn.zTree.init($('#gb_tree_areaSel'), selSetting, data.coverArea);
							    	$.fn.zTree.init($('#gb_tree_resourceSel'), selSetting, data.systemResource);
							    }
							});
						}else{
							$(".form-oneitem-box").hide();
						}
					});
					form.on('submit(*)', function(data){
						console.log(data.field)
						$.ajax({
							url: portsrc+"/practice/add/CyclePractice",
							type: 'get',
							dataType: 'json',
							data:{
								token:token,
								cyclePractice:JSON.stringify(data.field)
							},
							success: function(data) {
								layer.open({
									title: '提示',
									shadeClose:false,
									content: '新建成功',
									yes: function(index, layero){
										window.location.href='#/exercisePlan';
										layer.closeAll();
									}
								});
							}
						});
						return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
					});
				});
			}
		});

$('.weeklist li').click(function(){
	if($(this).hasClass('weekact')){
		$(this).removeClass('weekact');
	}else{
		$(this).addClass('weekact');
	}
})
$('.daytime .layui-input-inline input').click(function(){
			//console.log(11);
			$('.daytime .layui-input-inline').removeClass('layshow');
			$(this).parent().addClass('layshow');
		});
})
</script>