<div class="gb-monitoring">
	<!-- 消息滚动 -->
	<div class="gb-marquee">
		<marquee behavior="" direction="" align="absmiddle" onmouseover=stop() onmouseout=start()>
			<a href="##">
				<i class="iconfont icon-guangbo i"></i>
				<em class="i">国家应急平台消息国家应急平台消息国家应急平台消息</em>
			</a>
			<a href="##">
				<i class="iconfont icon-guangbo i"></i>
				<em class="i">国家应急平台消息国家应急平台消息国家应急平台消息</em>
			</a>
		</marquee>
	</div>
	<div class="gb-main">
		<!-- 事件按钮组 -->
		<div class="gb-incident-btn">
			<button class="layui-btn layui-btn-normal gb-all-incident cur incident-btn">全演练事件</button>
			<button class="layui-btn layui-btn-normal gb-unity-incident incident-btn">单一演练事件</button>
		</div>
		<!-- 事件总数 -->
		<div class="gb-incident-box">
			<!-- 发布效果（全事件） -->
			<div class="item gb-all-incident-item">
				<a href="manoeuvre-all-screen.html" target="_blank" class="layui-btn layui-btn-normal gb-projection-btn cur incident-btn">投屏全演练事件</a>
				<div class="gb-chart-box">
					<div class="gb-incident-count">
						<button class="layui-btn layui-btn-danger">演练事件总数：<em class="j-event-num">0</em></button>
						<button class="layui-btn layui-btn-warm">演练发布总数：<em  class="j-release-num">0</em></button>
					</div>
					<div class="gb-chart-incident-pie">
						<div class="gb-chart-item">
							<div class="gb-chart gb-pie" id="pie-incident"></div>
						</div>
						<div class="gb-chart-item">
							<div class="gb-chart gb-pie" id="pie-incident-rank"></div>
						</div>
						<div class="gb-chart-item">
							<div class="gb-chart gb-bar" id="bar-task-num"></div>
						</div>
					</div>
					<div class="gb-charts-table">
						<h4>
							<span class="j-table-chart-tab">
								<em class="list"><i class="iconfont icon-liebiao"></i>列表</em>
								<em class="cur chart"><i class="iconfont icon-zhexian"></i>折线图</em>
							</span>
						</h4>
						<div class="gb-table-chart-tab">
							<div class="gb-ctab" id="table-main3" style="display: none;">
								<div class="tablecont">
									<table class="table-main display" cellspacing="0" width="100%">
										<thead>
											<tr>
												<th>状态监测</th>
												<th>消息等级</th>
												<th>事件名称</th>
												<th>消息类别</th>
												<th>覆盖区域</th>
												<th>覆盖人口</th>
												<th>部门</th>
												<th>负责人</th>
												<th>发布时间</th>
											</tr>
										</thead>
										<tfoot>
											<tr>
												<th></th>
												<th></th>
												<th></th>
												<th></th>
												<th></th>
												<th></th>
												<th></th>
												<th></th>
												<th></th>
											</tr>
										</tfoot>
										<tbody>
											<tr>
												<td>发布中</td>
												<td><span class='rankimg' vel='红色'><img src='src/images/rank-red.png'/></span></td>
												<td><a class='view-cont'>杭州西湖区雷暴红色警报消息</a></td>
												<td>72万kem2</td>
												<td>110万</td>
												<td>杭州市西湖区应急广播中心</td>
												<td>橙子</td>
												<td>2017-11-09 12:0:0</td>
											</tr>
											<tr>
												<td>发布中</td>
												<td><span class='rankimg' vel='绿色'><img src='src/images/rank-green.png'/></span></td>
												<td><a class='view-cont'>杭州西湖区雷暴红色警报消息</a></td>
												<td>72万kem2</td>
												<td>110万</td>
												<td>杭州市西湖区应急广播中心</td>
												<td>橙子</td>
												<td>2017-11-09 12:0:0</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
							<div class="gb-chart-incident-bar gb-chart-incident">
								<div class="gb-chart-item">
									<div class="gb-chart gb-bar" id="bar-incident-type"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- 地图 -->
				<div class="gb-map-box">
					<div id="all-map" class="gb-map"></div>
					<div class="gb-map-zoom">
						<span class="cur j-zoom-province"><em>省</em></span>
						<span class="j-zoom-city"><em>市</em></span>
						<span class="j-zoom-county"><em>县</em></span>
					</div>
				</div>
			</div>
			<!-- 执行效果（单一事件） -->
			<div class="item gb-unity-incident-item" style="display: none;">
				<a href="manoeuvre-unity-screen.html" target="_blank" class="layui-btn layui-btn-normal gb-projection-btn cur incident-btn">投屏单一演练事件</a>
				<div class="gb-chart-box">
					<div class="gb-ctab" id="table-main1">
						<!-- <div class="tklay">
							<span class="talay-word"><i class="iconfont icon-rili"></i>发布时间</span>
							<div class="layui-input-inline">
						        <input type="text" class="layui-input" id="daterg" placeholder="选择时间范围">
						        <span class="tocho iconfont icon-shijian" id="tochobtn"></span> 
					    	</div>
					    </div> -->
					    <div class="tksearch">
					    	<input type="text" value="请输入任务消息名称，发布部门，负责人" onfocus="if(this.value==defaultValue){this.value = '';this.style.color='#333'}" onblur="if(!value){this.value = defaultValue;this.style.color='#ccc';}" class="dsearch" aria-controls="table-main"/>
					    	<span class="tksrh-btn"><i class="iconfont icon-sousuo"></i></span>
					    </div>
					    <div class="tablecont">
					    	<table class="table-main display" cellspacing="0" width="100%">
					    		<thead>
					    			<tr>
					    				<th>消息等级</th>
					    				<th>任务消息名称</th>
					    				<th>发布部门</th>
					    				<th>负责人</th>
					    				<th>创建时间</th>
					    				<th></th>
					    			</tr>
					    		</thead>
					    		<tfoot>
					    			<tr>
					    				<th></th>
					    				<th></th>
					    				<th></th>
					    				<th></th>
					    				<th></th>
					    				<th></th>
					    			</tr>
					    		</tfoot>
					    		<tbody>
						        	<!-- <tr>
						        		<td><span class='rankimg' vel='红色'><img src='src/images/rank-red.png'/></span></td>
						        		<td><a class='view-cont'>杭州西湖区雷暴红色警报消息</a></td>
						        		<td>杭州市西湖区应急广播中心</td>
						        		<td>橙子</td>
						        		<td>2017-09-08  18:10:20</td>
						        		<td><input type="button" value="监控" class="tomonitoring" /></td>
						        	</tr>
						        	<tr>
						        		<td><span class='rankimg' vel='红色'><img src='src/images/rank-red.png'/></span></td>
						        		<td><a class='view-cont'>杭州西湖区雷暴红色警报消息</a></td>
						        		<td>浙江省应急办</td>
						        		<td>橙子</td>
						        		<td>2017-09-08  18:10:20</td>
						        		<td><input type="button" value="监控" class="tomonitoring" /></td>
						        	</tr>
						        	<tr>
						        		<td><span class='rankimg' vel='黄色'><img src='src/images/rank-yellow.png'/></span></td>
						        		<td><a class='view-cont'>杭州西湖区雷暴红色警报消息</a></td>
						        		<td>杭州市西湖区应急广播中心</td>
						        		<td>橙子</td>
						        		<td>2017-09-08  18:10:20</td>
						        		<td><input type="button" value="监控" class="tomonitoring" /></td>
						        	</tr>
						        	<tr>
						        		<td><span class='rankimg' vel='绿色'><img src='src/images/rank-green.png'/></span></td>
						        		<td><a class='view-cont'>杭州西湖区雷暴红色警报消息</a></td>
						        		<td>杭州市西湖区应急广播中心</td>
						        		<td>橙子</td>
						        		<td>2017-09-08  18:16:20</td>
						        		<td><input type="button" value="监控" class="tomonitoring" /></td>
						        	</tr>
						        	<tr>
						        		<td><span class='rankimg' vel='橙色'><img src='src/images/rank-orange.png'/></span></td>
						        		<td><a class='view-cont'>杭州西湖区雷暴红色警报消息</a></td>
						        		<td>杭州市西湖区应急广播中心</td>
						        		<td>橙子</td>
						        		<td>2016-09-08  18:10:20</td>
						        		<td><input type="button" value="监控" class="tomonitoring tomact" /></td>
						        	</tr>
						        	<tr>
						        		<td><span class='rankimg' vel='蓝色'><img src='src/images/rank-blue.png'/></span></td>
						        		<td><a class='view-cont'>杭州西湖区雷暴红色警报消息</a></td>
						        		<td>杭州市西湖区应急广播中心</td>
						        		<td>橙子</td>
						        		<td>2017-09-08  18:10:20</td>
						        		<td><input type="button" value="监控" class="tomonitoring" /></td>
						        	</tr> -->
						        </tbody>
						    </table>
						</div>
					</div>
					<!-- 杭州西湖区雷暴红色警报消息播发统计 -->
					<div class="gb-charts-table">
						<h4>
							<button class="layui-btn layui-btn-danger">杭州西湖区雷暴红色警报消息播发统计</button>
							<span class="j-table-chart-tab">
								<em class="list"><i class="iconfont icon-liebiao"></i>列表</em>
								<em class="cur chart"><i class="iconfont icon-zhexian"></i>折线图</em>
							</span>
						</h4>
						<div class="gb-table-chart-tab">
							<div class="gb-ctab" id="table-main2" style="display: none;">
								<div class="tablecont">
									<table class="table-main display" cellspacing="0" width="100%">
										<thead>
											<tr>
												<th>区域名</th>
												<th>传输覆盖平台资源名</th>
												<th>接受回执</th>
												<th>播发反馈</th>
												<th>接受回执时间</th>
												<th>播发反馈时间</th>
											</tr>
										</thead>
										<tfoot>
											<tr>
												<th></th>
												<th></th>
												<th></th>
												<th></th>
												<th></th>
												<th></th>
											</tr>
										</tfoot>
										<tbody>
											<tr>
												<td>区域名区域名1</td>
												<td>传输覆盖平台资源名1</td>
												<td>接受回执接受回执1</td>
												<td>播发反馈播发反馈1</td>
												<td>2017-09-08  18:10:20</td>
												<td>2017-09-08  18:10:20</td>
											</tr>
											<tr>
												<td>区域名区域名2</td>
												<td>传输覆盖平台资源名2</td>
												<td>接受回执接受回执2</td>
												<td>播发反馈播发反馈2</td>
												<td>2017-09-08  18:10:20</td>
												<td>2017-09-08  18:10:20</td>
											</tr>
											<tr>
												<td>区域名区域名3</td>
												<td>传输覆盖平台资源名3</td>
												<td>接受回执接受回执3</td>
												<td>播发反馈播发反馈3</td>
												<td>2017-09-08  18:10:20</td>
												<td>2017-09-08  18:10:20</td>
											</tr>
											<tr>
												<td>区域名区域名4</td>
												<td>传输覆盖平台资源名4</td>
												<td>接受回执接受回执4</td>
												<td>播发反馈播发反馈4</td>
												<td>2017-09-08  18:10:20</td>
												<td>2017-09-08  18:10:20</td>
											</tr>
											<tr>
												<td>区域名区域名5</td>
												<td>传输覆盖平台资源名5</td>
												<td>接受回执接受回执5</td>
												<td>播发反馈播发反馈5</td>
												<td>2017-09-08  18:10:20</td>
												<td>2017-09-08  18:10:20</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
							<div class="gb-chart-incident-line gb-chart-incident">
								<div class="gb-chart-item">
									<div class="gb-chart gb-line" id="line-population"></div>
								</div>
								<div class="gb-chart-item">
									<div class="gb-chart gb-line" id="line-district"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- 地图 -->
				<div class="gb-map-box">
					<div id="unity-map" class="gb-map"></div>
					<div class="gb-map-zoom">
						<span class="cur j-zoom-province"><em>省</em></span>
						<span class="j-zoom-city"><em>市</em></span>
						<span class="j-zoom-county"><em>县</em></span>
					</div>
					<div class="gb-map-legend">
						<span class="j-legend-succeed">
							<i></i>
							<em>已覆盖</em>
						</span>
						<span class="j-legend-process">
							<i></i>
							<em>未完全覆盖</em>
						</span>
						<span class="j-legend-failure">
							<i></i>
							<em>未覆盖</em>
						</span>
					</div>
				</div>
			</div>
		</div>
	</div>

	

	<p class="gb-copyright">© 2017-2018 浙江省应急广播平台</p>
</div>
<div class="viewdetail">
	<div class="detadiv">
		<p class="poptit">任务消息详情</p>
		<span class="viewclose"><i class="iconfont icon-guanbi"></i></span>
		<div class="uncont">
			<p class="oneitem-tit">消息等级</p>
			<p class="unword">红色</p>
			<p class="oneitem-tit">任务消息名称</p>
			<p class="unword">杭州西湖区雷暴红色警报消息</p>
			<p class="oneitem-tit">发布部门</p>
			<p class="unword">杭州市西湖区应急广播中心</p>
			<p class="oneitem-tit">负责人</p>
			<p class="unword">橙子</p>
			<p class="oneitem-tit">创建时间</p>
			<p class="unword">2017-11-09 12:00</p>
		</div>
	</div>
</div>
<script type="text/javascript">
var boolunity=true;//控制全事件和单一事件只执行一次
var boolall=true;//控制全事件和单一事件只执行一次
var incidentChart=null;//全事件-事件发布图表
var incidentRankChart=null;//全事件-事件级别发布图表
var taskNumChart=null;//全事件-任务数量图表
var incidentTypeChart=null;//全事件-事件类型统计数据图表
var allMapChart=null;//全事件-地图覆盖图表-迁徙图

var populationChart=null;//单一事件-覆盖人口图表
var districtChart=null;//单一事件-覆盖区域图表

/************************** 执行效果（单一事件） *******************************************/
function unityIncident(taskId,type) {
	console.log(type);
	if(boolunity){
		// console.log(type);
		// type='cycle';
		// 覆盖人口
		$.ajax({
			url: portsrc+'/peopleAffect',
			type: 'GET',
			dataType: 'json',
			data:{
				token:token,
				id:taskId,
				type:type
			},
			success: function(data) {
				// console.log(data)
				var xAxis=[];
				var value=[];
				for (var i = 0; i < data.body.split(';').length; i++) {
					xAxis.push(data.body.split(';')[i].split('-')[0])
					value.push(data.body.split(';')[i].split('-')[1])
				}
				populationChart = echarts.init(document.getElementById('line-population'));
				populationOption = {
					title: {
						text: '时间',
						textStyle:{
							color:'#7c8491',
							fontSize:13,
						},
						bottom:'4%',
						left:"1%"
					},
					tooltip: {
				        // trigger: 'axis',
				        formatter: function (params, ticket, callback) {
				        	// var html='<div class="gb-line-formatter">'+params.seriesName+'<br /><em>'+params.data.percent+'</em>%，<em>'+params.data.value+'</em>万人</div>'
				        	var html='<div class="gb-line-formatter">'+params.seriesName+'<br />'+params.data+'</em>万人</div>'
						    // 固定在顶部
						    return html;
						},
						position: function (point, params, dom, rect, size) {
						    // 固定在顶部
						    return {left:point[0]-$(dom).width()/2, top:point[1]-$(dom).height()-10};
						},
						backgroundColor: 'rgba(255,255,255,0)',
						axisPointer: {
							type: 'line',
							lineStyle: {
								type: 'dashed',
								color:'#6e6fe6'
							},
						},
					},
					grid: {
						top:'1%',
						left: '3%',
						right: '2%',
						bottom:"18%",
						containLabel: true
					},
				    // 区域缩放
				    dataZoom: [
				    {
				    	start: 10,
				    	end: 90,
				    	backgroundColor:"#d0daeb",
				    	fillerColor:"#6e6fe6",
				    	handleIcon: handleIcon,
				    	handleSize: '60%',
				    	handleStyle: {
				    		color: '#fff',
				    	},
				    	showDataShadow:false,
				    	height: 22,
				    },
				    {
				    	type: 'inside',
				    }
				    ],
				    xAxis: {
				    	type: 'category',
				    	boundaryGap: false,
				        //坐标轴名称
				        name: '覆盖人口',
				        nameGap: 30,
				        // nameRotate:0,
				        nameLocation: "center",
				        nameTextStyle:{
				        	color:"#7c8491",
				        },
				        data: xAxis,
				        splitLine: { //设置X轴的网格
				        	show: true,
				        	interval: 'auto',
				        	lineStyle:{
								color: '#f0f0f0'//网格线颜色
							}
						},
				        //刻度横线
				        axisTick: {
				        	show: false
				        },
				        //刻度字样式
				        axisLabel: {
				        	textStyle: {
				        		color: '#7c8491',
				        		fontSize:'12',
				        		align: 'center'
				        	},
				        },
				        //刻度线
				        axisLine: {
				        	lineStyle: {
				                color:"#f0f0f0"//刻度线颜色
				            }
				        },
				    },
				    yAxis: {
				        //坐标轴名称
				        name: '单位：万人',
				        nameGap: 40,
				        // nameRotate:0,
				        nameLocation: "middle",
				        nameTextStyle:{
				        	color:"#7c8491",
				        },
				        //刻度横线
				        axisTick: {
				        	show: false
				        },
				        //刻度字样式
				        axisLabel: {
				        	textStyle: {
				        		color: '#7c8491',
				        		fontSize:'12',
				        	}
				        },
				        //刻度线
				        axisLine: {
				        	lineStyle: {
				                color:"#f0f0f0"//刻度线颜色
				            }
				        },
				        //网格线
				        splitLine:{
				        	lineStyle:{
								color: '#f0f0f0'//网格线颜色
							}
						},
					},
					series: [{
						name:'覆盖人口',
						type: 'line',
						symbol:'image://src/images/icon-line-formatter.png',
				        // showSymbol:false,
				        symbolSize:'15',
				        data:value,
				        itemStyle:{
				        	normal:{
				        		color:"#7778e8"
				        	}
				        }
				    }]
				};
				populationChart.setOption(populationOption);
			}
		});

		// 覆盖区域
		$.ajax({
			url: portsrc+'/areaAffect',
			type: 'GET',
			dataType: 'json',
			data:{
				token:token,
				id:taskId,
				type:type
			},
			success: function(data) {
				districtChart = echarts.init(document.getElementById('line-district'));
				var xAxis=[];
			    var value=[];
			    for (var i = 0; i < data.body.split(';').length; i++) {
			    	xAxis.push(data.body.split(';')[i].split('-')[0])
			    	value.push(data.body.split(';')[i].split('-')[1])
			    }
				districtOption = {
					title: {
						text: '时间',
						textStyle:{
							color:'#7c8491',
							fontSize:13,
						},
						bottom:'4%',
						left:"1%"
					},
					tooltip: {
				        // trigger: 'axis',
				        formatter: function (params, ticket, callback) {
				        	// var html='<div class="gb-line-formatter">'+params.seriesName+'<br /><em>'+params.data.percent+'</em>%，<em>'+params.data.value+'</em>万人</div>'
				        	var html='<div class="gb-line-formatter">'+params.seriesName+'<br />'+params.data+'</em>万人</div>'
						    // 固定在顶部
						    return html;
						},
						position: function (point, params, dom, rect, size) {
						    // 固定在顶部
						    return {left:point[0]-$(dom).width()/2, top:point[1]-$(dom).height()-10};
						},
						backgroundColor: 'rgba(255,255,255,0)',
						axisPointer: {
							type: 'line',
							lineStyle: {
								type: 'dashed',
								color:'#6e6fe6'
							},
						},
					},
					grid: {
						top:'1%',
						left: '3%',
						right: '2%',
						bottom:"18%",
						containLabel: true
					},
				    // 区域缩放
				    dataZoom: [
				    {
				    	start: 10,
				    	end: 90,
				    	backgroundColor:"#d0daeb",
				    	fillerColor:"#3d749a",
				    	handleIcon: handleIcon,
				    	handleSize: '60%',
				    	handleStyle: {
				    		color: '#fff',
				    	},
				    	showDataShadow:false,
				    	height: 22,
				    },
				    {
				    	type: 'inside',
				    }
				    ],
				    xAxis: {
				    	type: 'category',
				    	boundaryGap: false,
				        //坐标轴名称
				        name: '覆盖区域',
				        nameGap: 30,
				        // nameRotate:0,
				        nameLocation: "center",
				        nameTextStyle:{
				        	color:"#7c8491",
				        },
				        data: xAxis,
				        splitLine: { //设置X轴的网格
				        	show: true,
				        	interval: 'auto',
				        	lineStyle:{
								color: '#f0f0f0'//网格线颜色
							}
						},
				        //刻度横线
				        axisTick: {
				        	show: false
				        },
				        //刻度字样式
				        axisLabel: {
				        	textStyle: {
				        		color: '#7c8491',
				        		fontSize:'12',
				        		align: 'center'
				        	},
				        },
				        //刻度线
				        axisLine: {
				        	lineStyle: {
				                color:"#f0f0f0"//刻度线颜色
				            }
				        },
				    },
				    yAxis: {
				        //坐标轴名称
				        name: '单位：平方公里',
				        nameGap: 40,
				        // nameRotate:0,
				        nameLocation: "middle",
				        nameTextStyle:{
				        	color:"#7c8491",
				        },
				        //刻度横线
				        axisTick: {
				        	show: false
				        },
				        //刻度字样式
				        axisLabel: {
				        	textStyle: {
				        		color: '#7c8491',
				        		fontSize:'12',
				        	}
				        },
				        //刻度线
				        axisLine: {
				        	lineStyle: {
				                color:"#f0f0f0"//刻度线颜色
				            }
				        },
				        //网格线
				        splitLine:{
				        	lineStyle:{
								color: '#f0f0f0'//网格线颜色
							}
						},
					},
					series: [{
						name:'覆盖人口',
						type: 'line',
						symbol:'image://src/images/icon-taskNumformatter.png',
				        // showSymbol:false,
				        symbolSize:'15',
				        data: value,
				        itemStyle:{
				        	normal:{
				        		color:"#3d749a"
				        	}
				        }
				    }]
				};
				districtChart.setOption(districtOption);
			}
		});


		// 地图
		$.ajax({
			url: portsrc+'/mapUnityChart',
			type: 'GET',
			dataType: 'json',
			data:{
				token:token,
				id:taskId,
				type:type
			},
			success: function(data) {
		    	// console.log(data);
		    	if (data.body) {
				unitybmap = new BMap.Map("unity-map"); // 创建地图实例，禁止点击地图底图
				unitybmap.centerAndZoom(new BMap.Point(data.body.center[0],data.body.center[1]), 8);
				unitybmap.enableScrollWheelZoom(true);
				blist = [];
				districtLoading = 0;
				setTimeout(function () {
				    // 地图划分区域地点
				    for (var i = 0; i < data.body.divideMap.length; i++) {
				    	// data.body.addDistrict[i].name='绍兴';
				    	addDistrict(data.body.divideMap[i].name,unitybmap,data.body.divideMap[i].color);
					    // addDistrict("龙游县",unitybmap,"#ff5b57");
					    // addDistrict("宁波",unitybmap,"#ff5b57");
					    // addDistrict("嘉兴",unitybmap,"#fada00");
					    // addDistrict("绍兴",unitybmap,"#14ae8f");
					    // addDistrict("台州",unitybmap,"#14ae8f");
					    // addDistrict("温州",unitybmap,"#ff5b57");
					}
				    // #ff5b57代表未覆盖，#14ae8f代表已覆盖，#fada00代表未完全覆盖
				}, 100);
			}
		}
	});
		var param={
			token:token,
			id:taskId,
			type:'practice'
		};
		// console.log(typeof param.id);
		table2.settings()[0].ajax.data = param;
		table2.ajax.reload();
	}
	boolunity=false;
}


/************************** 发布效果（全事件） *******************************************/
function addIncident() {
	if(boolall){
		incidentChart = echarts.init(document.getElementById('pie-incident'));
		incidentRankChart = echarts.init(document.getElementById('pie-incident-rank'));
		taskNumChart = echarts.init(document.getElementById('bar-task-num'));
		incidentTypeChart = echarts.init(document.getElementById('bar-incident-type'));


		// 事件发布 
		$.ajax({
			url: portsrc+'/taskByDepartment',
			type: 'GET',
			dataType: 'json',
			data:{
				token:token,
				type:'practice'
			},
			success: function(data) {
				// console.log(data);
				if(data.body!=null){
					incidentOption = {
						title: {
							text: '事件发布',
							bottom: '0',
							left:'center',
							textStyle: { 
								color: '#585c65'
							}
						},
						tooltip : {
							formatter: "{b} : {c} ({d}%)"
						},
						legend: {
					        // orient: 'vertical',
					        x: 'center',
					        bottom: '10%',
					        itemWidth:'10',
					        itemHeight:'10',
					        data:['气象局','水利','国家应急广播平台','应急办'],
					        align:"right"
					    },
					    series : [
					    {
					    	type:'pie',
					    	radius : '60%',
					    	center: ['50%', '43%'],
					    	data:data.body.sort(function (a, b) { return a.value - b.value; }),
					    	roseType: 'radius',
					    	label: {
					    		normal: {
					    			textStyle: {
					    				color: '#7c8491'
					    			}
					    		}
					    	},
					    	labelLine: {
					    		normal: {
					    			lineStyle: {
					    				color: '#d8d8d8'
					    			},
					    			smooth: 0.2,
					    			length: 0,
					    			length2: 20
					    		}
					    	},
					    	itemStyle: {
					    		normal: {
					    			shadowBlur: 15,
					    			shadowColor: 'rgba(0, 0, 0, 0.4)',
					    			label:{
					    				formatter:'{d}%',
					    			},
					    		}
					    	},

					    	animationType: 'scale',
					    	animationEasing: 'elasticOut',
					    	animationDelay: function (idx) {
					    		return Math.random() * 200;
					    	}
					    }
					    ]
					};
					incidentChart.setOption(incidentOption);
				}
			}
		});

		// 事件级别发布 
		$.ajax({
			url: portsrc+'/incidentRankChart',
			type: 'GET',
			dataType: 'json',
			data:{
				token:token,
				type:'practice'
			},
			success: function(data) {
				if(data.body!=null){
					legendData=[];
					for (var i = 0; i < data.body.length; i++) {
						if(data.body[i].name=='RED'){
							legendData.push('红色事件');
							data.body[i].name='红色事件';
							data.body[i].itemStyle={
								normal: {
									color: "#f75c53"
								}
							};
						}else if(data.body[i].name=='BLUE'){
							legendData.push('蓝色事件');
							data.body[i].name='蓝色事件';
							data.body[i].itemStyle={
								normal: {
									color: "#4579d8"
								}
							};
						}else if(data.body[i].name=='GREEN'){
							legendData.push('绿色事件');
							data.body[i].name='绿色事件';
							data.body[i].itemStyle={
								normal: {
									color: "#14ae8f"
								}
							};
						}else if(data.body[i].name=='ORANGE'){
							legendData.push('橙色事件');
							data.body[i].name='橙色事件';
							data.body[i].itemStyle={
								normal: {
									color: "#fea41e"
								}
							};
						}else if(data.body[i].name=='YELLOW'){
							legendData.push('黄色事件');
							data.body[i].name='黄色事件';
							data.body[i].itemStyle={
								normal: {
									color: "#fada00"
								}
							};
						}
					}
					incidentRankOption = {
						title: {
							text: '事件级别发布',
							bottom: '0',
							left:'center',
							textStyle: { 
								color: '#585c65'
							}
						},
						tooltip : {
							formatter: "{b} : {c} ({d}%)"
						},
						legend: {
					        // orient: 'vertical',
					        x: 'center',
					        bottom: '10%',
					        itemWidth:'10',
					        itemHeight:'10',
					        data:legendData,
					        align:"right"
					    },
					    series : [
					    {
					    	type:'pie',
					    	radius : '60%',
					    	center: ['50%', '43%'],
					    	data:data.body.sort(function (a, b) { return a.value - b.value; }),
					    	roseType: 'radius',
					    	label: {
					    		normal: {
					    			textStyle: {
					    				color: '#7c8491'
					    			}
					    		}
					    	},
					    	labelLine: {
					    		normal: {
					    			lineStyle: {
					    				color: '#d8d8d8'
					    			},
					    			smooth: 0.2,
					    			length: 10,
					    			length2: 20
					    		}
					    	},
					    	itemStyle: {
					    		normal: {
					    			shadowBlur: 15,
					    			shadowColor: 'rgba(0, 0, 0, 0.4)',
					    			label:{
					    				formatter:'{d}%',
					    			},
					    		}
					    	},
					    	markLine:{
					    		symbolSize:1000
					    	},
					    	animationType: 'scale',
					    	animationEasing: 'elasticOut',
					    	animationDelay: function (idx) {
					    		return Math.random() * 200;
					    	}
					    }
					    ]
					};
					incidentRankChart.setOption(incidentRankOption);
				}
			}
		});

		// 任务数量
		$.ajax({
			url: portsrc+'/taskNumChart',
			type: 'GET',
			dataType: 'json',
			data:{
				token:token,
				type:'practice'
			},
			success: function(data) {
				if(data.body!=null){
					var taskNumData =data.body;
					var yMax = [];
					var dataShadow = [];
					var xAxisData=[];
					for (var i = 0; i < taskNumData.length; i++) {
						xAxisData.push(taskNumData[i].type);
						yMax.push(taskNumData[i].value);
					}
					for (var i = 0; i < taskNumData.length; i++) {
						dataShadow.push(yMax.sort()[yMax.length-1]);
					}
					taskNumOption = {
						title: {
							text: '任务数量',
							bottom: '0',
							left:'center',
							textStyle: { 
								color: '#585c65'
							}
						},
						tooltip : {
					    	// formatter:"{b}<br />{c}个",
					    	formatter: '<div class="gb-bar-formatter">{b}<br /><em>{c}</em></div>',
					  //   	position: function (point, params, dom, rect, size) {
							//     // 固定在顶部
							//     return {left: rect.x-($(dom).width()-rect.width)/1.5, top: rect.y-$(dom).height()-10};
							// },
							position: "top",
							backgroundColor: 'rgba(255,255,255,0)',
					        // borderColor:"#d8d8d8",
					        // borderWidth:1,
					        // textStyle:{
					        // 	color:"#000"
					        // },
					    },
					    grid: {
					    	left: '8%',
					    	containLabel: true
					    },
					    xAxis: {
					        // data: ['等待审核', '等待发布', '正在发布', '发布完成'],
					        data: xAxisData,
					        //刻度横线
					        axisTick: {
					        	show: false
					        },
					        //刻度字样式
					        axisLabel: {
					        	textStyle: {
					        		color: '#7c8491',
					        		fontSize:'14',
					        		align: 'center'
					        	},
					        	interval:0,
				         		// margin: 30,
								// rotate:-20,
							},
					        //刻度线
					        axisLine: {
					        	lineStyle: {
					        		color:"#e5e5e5"
					        	}
					        },
					        z: 10
					    },
					    yAxis: [{
					        //坐标轴名称
					        name: '单位：个',
					        nameGap: 40,
					        // nameRotate:0,
					        nameLocation: "middle",
					        nameTextStyle:{
					        	color:"#7c8491",
					        },
					        //刻度横线
					        axisTick: {
					        	show: false
					        },
					        //刻度字样式
					        axisLabel: {
					        	textStyle: {
					        		color: '#7c8491',
					        		fontSize:'14'
					        	}
					        },
					        //刻度线
					        axisLine: {
					        	lineStyle: {
					                color:"#e5e5e5"//刻度线颜色
					            }
					        },
					        //网格线
					        splitLine:{
					        	lineStyle:{
									color: '#e5e5e5'//网格线颜色
								}
							},
						},{
							'type': 'value',
							'max': 200,
							axisLine: {
								lineStyle: {
									color:"#e5e5e5"
								}
							}
						}],
						dataZoom: [
						{
							type: 'inside'
						}
						],
						series: [
					        { // For shadow
					        	type: 'bar',
					        	itemStyle: {
					        		normal: {color: '#f7f8fa'}
					        	},
					        	silent: true,
					        	barGap:'-100%',
					        	barCategoryGap:'40%',
					        	data: dataShadow,
					        	animation: false
					        },
					        {
					        	type: 'bar',
					        	data: taskNumData,
					        	itemStyle:{
					        		normal:{
					        			color:function(params) {
					        				var colorList=['#41cefb','#00aaff','#1ba5dd','#4579d8'];
					        				return colorList[params.dataIndex%4];
					        			}
					        		}
					        	}
					        }
					        ]
					    };
					    taskNumChart.setOption(taskNumOption);
					}
				}
			});


		// 事件类型统计数据
		$.ajax({
			url: portsrc+'/incidentTypeChart',
			type: 'GET',
			dataType: 'json',
			data:{
				token:token,
				type:'practice'
			},
			success: function(data) {
				if(data.body!=null){
					var incidentTypeData =data.body;
					var yMaxTwo = [];
				    // x轴数据
				    var incidentTypexAxis=[];
				    for (var i = 0; i < data.body.length; i++) {
				    	incidentTypexAxis.push(data.body[i].type);
				    	yMaxTwo.push(data.body[i].value);
				    }
				    // 对x轴数据换行处理，4个字换行
				    var incidentTypexAxisData=[];
				    for (var i = 0; i < incidentTypexAxis.length; i++) {
				    	var strs = incidentTypexAxis[i].split(''); //字符串数组
				    	var str = ''
				        for (var j = 0, s; s = strs[j++];) { //遍历字符串数组
				        	str += s;
				        	if (!(j % 5)) str += '\n';
				        }
				        incidentTypexAxisData.push(str)
				    }
				    var dataShadowTwo = [];
				    for (var i = 0; i < incidentTypeData.length; i++) {
				    	dataShadowTwo.push(yMaxTwo.sort()[yMaxTwo.length-1]);
				    }
				    incidentTypeOption = {
				    	title: {
				    		text: '事件类型统计数据',
				    		bottom: '3%',
				    		left:'center',
				    		textStyle: { 
				    			color: '#585c65'
				    		}
				    	},
					    // 区域缩放
					    dataZoom: [
					    {
					    	start: 30,
					    	end: 70,
					    	bottom: '12%',
					    	backgroundColor:"#d0daeb",
					    	fillerColor:"#6e6fe6",
					    	handleIcon: handleIcon,
					    	handleSize: '60%',
					    	handleStyle: {
					    		color: '#fff',
					    	},
					    	showDataShadow:false,
					    },
					    {
					    	type: 'inside',
					    }
					    ],
					    tooltip : {
					    	formatter: '<div class="gb-bar-formatter">{b}<br /><em>{c}</em></div>',
					    	position: "top",
					    	backgroundColor: 'rgba(255,255,255,0)',
					    },
					    grid: {
					    	containLabel: true,
					    	top:'5%',
					    	left:'5%',
					    	right:'3%',
					    	bottom: '23%',
					    },
					    xAxis: {
					    	data:incidentTypexAxisData,
					        //刻度横线
					        axisTick: {
					        	show: false
					        },
					        //刻度字样式
					        axisLabel: {
					        	textStyle: {
					        		color: '#7c8491',
					        		fontSize:'14',
					        		align: 'center'
					        	},
					            // interval:0,//x轴是否自动调整显示数量
					            // formatter:function(val){
					            // 	var strs = val.split(''); //字符串数组
				             //        var str = ''
				             //        for (var i = 0, s; s = strs[i++];) { //遍历字符串数组
				             //            str += s;
				             //            if (!(i % 4)) str += '\n';
				             //        }
				             //        return str
					            // }
				         		// margin: 30,
								// rotate:-20,
							},
					        //刻度线
					        axisLine: {
					        	lineStyle: {
					        		color:"#e5e5e5"
					        	}
					        },
					        z: 10
					    },
					    yAxis: [{
					        //坐标轴名称
					        name: '单位：个',
					        nameGap: 40,
					        // nameRotate:0,
					        nameLocation: "middle",
					        nameTextStyle:{
					        	color:"#7c8491",
					        },
					        //刻度横线
					        axisTick: {
					        	show: false
					        },
					        //刻度字样式
					        axisLabel: {
					        	textStyle: {
					        		color: '#7c8491',
					        		fontSize:'14'
					        	}
					        },
					        //刻度线
					        axisLine: {
					        	lineStyle: {
					                color:"#e5e5e5"//刻度线颜色
					            }
					        },
					        //网格线
					        splitLine:{
					        	lineStyle:{
									color: '#e5e5e5'//网格线颜色
								}
							},
						},{
							'type': 'value',
							'max': 200,
							axisLine: {
								lineStyle: {
									color:"#e5e5e5"
								}
							}
						}],
						series: [
					        { // For shadow
					        	type: 'bar',
					        	itemStyle: {
					        		normal: {color: '#f7f8fa'}
					        	},
					        	silent: true,
					        	barGap:'-100%',
					        	barCategoryGap:'40%',
					        	data: dataShadowTwo,
					        	animation: false
					        },
					        {
					        	type: 'bar',
					        	data: incidentTypeData,
					        	itemStyle:{
					        		normal:{
					        			color:function(params) {
					        				var colorList=['#949eff','#9b7fe2','#6b65df'];
					        				return colorList[params.dataIndex%3];
					        			}
					        		}
					        	}
					        }
					        ]
					    };
					    incidentTypeChart.setOption(incidentTypeOption);
					}
				}
			});


		// 地图
		// bmap.clearOverlays();
		$.ajax({
			url: portsrc+'/mapAllChart',
			type: 'GET',
			dataType: 'json',
			data:{
				token:token,
				type:'practice'
			},
			success: function(data) {
		    	// console.log(data);
		    	if(data.body!=null){
		    		allMapChart = echarts.init(document.getElementById('all-map'));
					var geoCoordMap = data.body.geoCoordMap;//地点坐标\
					var BJData =[];//迁徙数据
					// data.body.bjData=[{
					// 	"from": "杭州", //出发点
					// 	"incident_data": [{
					// 		"orange": "暴雨事件"
					// 	}, {
					// 		"red": "暴风事件"
					// 	}, {
					// 		"blue": "龙卷风事件"
					// 	}],
					// 	"to": "宁波" //到达点
					// }]
					for (var i = 0; i < data.body.bjData.length; i++) {
						var incident_data=[];
						for(var j = 0; j < data.body.bjData[i].incident_data.length; j++){
							for(var g in data.body.bjData[i].incident_data[j]){
								incident_data.push({
									color: g,
									incident_name: data.body.bjData[i].incident_data[j][g]
								})
							}
						};

						BJData.push([
						{
				                name: data.body.bjData[i].from //出发点
				            },
				            {
				                name: data.body.bjData[i].to, //到达点
				                incident: data.body.bjData[i].incident, //事件颜色
				                incident_data: incident_data //具体事件
				            }
				            ])
					}
					var startData=[];//迁徙起点数据
					for(var j = 0; j < data.body.startData.length; j++){
						for(var g in data.body.startData[j]){
							startData.push({
								color: g,
								incident_name: data.body.startData[j][g]
							})
						}
					};

					var convertData = function(data) {
						var res = [];
						for (var i = 0; i < data.length; i++) {
							var dataItem = data[i];
							var fromCoord = geoCoordMap[dataItem[0].name];
							var toCoord = geoCoordMap[dataItem[1].name];
							if (fromCoord && toCoord) {
								res.push({
									fromName: dataItem[0].name,
									toName: dataItem[1].name,
									coords: [fromCoord, toCoord]
								});
							}
						}
						return res;
					};
					var mapSeries = [];
					[
					[data.body.out, BJData],
					].forEach(function(item, i) {
						mapSeries.push(
						    {//出发圆点
						    	type: 'effectScatter',
						    	coordinateSystem: 'bmap',
						    	zlevel: 2,
						    	symbolSize: 15,
						    	itemStyle: {
						    		normal: {
						    			color: "red",
						    			shadowColor: 'red',
						    			shadowBlur: 40,
						    			shadowOffsetX:5,
						    			shadowOffsetY:5
						    		}
						    	},
						    	data: [{
						    		name: item[0],
						    		value:geoCoordMap[item[0]]!=undefined?geoCoordMap[item[0]].concat([50]):[],
						    		incident_data:startData

						    	}]
						    },{//线、飞机
						    	type: 'lines',
						    	coordinateSystem: 'bmap',
						    	zlevel: 2,
					    		// symbol:"rect",
					    		effect: {
					    			show: true,
					    			period: 6,
					    			trailLength: 0,
					    			symbol: planePath,
					    			symbolSize: 35
					    		},
					    		lineStyle: {
					    			normal: {
					    				color: "red",
					    				width: 2,
					    				curveness: 0.2,
					    				type: 'dotted'
					    			}
					    		},
					    		data: convertData(item[1])
						    }, {//省份圆点红色事件
						    	name:"红色事件",
						    	type: 'effectScatter',
						    	coordinateSystem: 'bmap',
						    	zlevel: 2,
						    	symbolSize: 20,
					    		// symbol:"rect",//正方形
					    		rippleEffect: {
					    			brushType: 'stroke'
					    		},
					    		itemStyle: {
					    			normal: {
						                color: function(params) {//省份圆点颜色设置
						    				//console.log(params)
											// var tmp = params.data.incident;
											// if (tmp == 'orange') {
											// 	return '#ff9700';//橙色事件
											// } else if (tmp == 'green') {
											// 	return '#00e1b4';//绿色事件
											// } else if (tmp == 'blue') {
											// 	return '#518fff';//蓝色事件
											// } else if (tmp == 'red') {
												return '#ff3833';//红色事件
											// } else {
											// 	return '#fada00';//黄色事件
											// }
										},
										shadowColor: '#ff3833',
										shadowBlur: 25,
										shadowOffsetX:5,
										shadowOffsetY:5,
									}
								},
								data: item[1].map(function(dataItem) {
									if(dataItem[1].incident=="red"){
										return {
											value: geoCoordMap[dataItem[1].name]!=undefined?geoCoordMap[dataItem[1].name].concat([dataItem[1].value]):[],
											incident:dataItem[1].incident,
											incident_data:dataItem[1].incident_data
										};
									}
								})
						    }, {//省份圆点橙色事件
						    	name:"橙色事件",
						    	type: 'effectScatter',
						    	coordinateSystem: 'bmap',
						    	zlevel: 2,
						    	symbolSize: 20,
					    		// symbol:"rect",//正方形
					    		rippleEffect: {
					    			brushType: 'stroke'
					    		},
					    		itemStyle: {
					    			normal: {
						                color: function(params) {//省份圆点颜色设置
						    				// console.log(params)
											// var tmp = params.data.incident;
											// if (tmp == 'orange') {
												return '#ff9700';//橙色事件
											// } else if (tmp == 'green') {
											// 	return '#00e1b4';//绿色事件
											// } else if (tmp == 'blue') {
											// 	return '#518fff';//蓝色事件
											// } else if (tmp == 'red') {
												// return '#ff3833';//红色事件
											// } else {
											// 	return '#fada00';//黄色事件
											// }
										},
										shadowColor: '#ff9700',
										shadowBlur: 40,
										shadowOffsetX:5,
										shadowOffsetY:5,
									}
								},
								data: item[1].map(function(dataItem) {
									if(dataItem[1].incident=="orange"){
										return {
											value: geoCoordMap[dataItem[1].name]!=undefined?geoCoordMap[dataItem[1].name].concat([dataItem[1].value]):[],
											incident:dataItem[1].incident,
											incident_data:dataItem[1].incident_data
										};
									}
								})
						    }, {//省份圆点黄色事件
						    	name:"黄色事件",
						    	type: 'effectScatter',
						    	coordinateSystem: 'bmap',
						    	zlevel: 2,
						    	symbolSize: 20,
					    		// symbol:"rect",//正方形
					    		rippleEffect: {
					    			brushType: 'stroke'
					    		},
					    		itemStyle: {
					    			normal: {
						                color: function(params) {//省份圆点颜色设置
											// var tmp = params.data.incident;
											// if (tmp == 'orange') {
												// return '#ff9700';//橙色事件
											// } else if (tmp == 'green') {
											// 	return '#00e1b4';//绿色事件
											// } else if (tmp == 'blue') {
											// 	return '#518fff';//蓝色事件
											// } else if (tmp == 'red') {
												// return '#ff3833';//红色事件
											// } else {
												return '#fada00';//黄色事件
											// }
										},
										shadowColor: '#fada00',
										shadowBlur: 40,
										shadowOffsetX:5,
										shadowOffsetY:5,
									}
								},
								data: item[1].map(function(dataItem) {
									if(dataItem[1].incident=="yellow"){
										return {
											value: geoCoordMap[dataItem[1].name]!=undefined?geoCoordMap[dataItem[1].name].concat([dataItem[1].value]):[],
											incident:dataItem[1].incident,
											incident_data:dataItem[1].incident_data
										};
									}
								})
						    }, {//省份圆点蓝色事件
						    	name:"蓝色事件",
						    	type: 'effectScatter',
						    	coordinateSystem: 'bmap',
						    	zlevel: 2,
						    	symbolSize: 20,
					    		// symbol:"rect",//正方形
					    		rippleEffect: {
					    			brushType: 'stroke'
					    		},
					    		itemStyle: {
					    			normal: {
						                color: function(params) {//省份圆点颜色设置
						     //    			console.log(params)
											// var tmp = params.data.incident;
											// if (tmp == 'orange') {
												// return '#ff9700';//橙色事件
											// } else if (tmp == 'green') {
											// 	return '#00e1b4';//绿色事件
											// } else if (tmp == 'blue') {
												return '#518fff';//蓝色事件
											// } else if (tmp == 'red') {
												// return '#ff3833';//红色事件
											// } else {
												// return '#fada00';//黄色事件
											// }
										},
										shadowColor: '#518fff',
										shadowBlur: 40,
										shadowOffsetX:5,
										shadowOffsetY:5,
									}
								},
								data: item[1].map(function(dataItem) {
									if(dataItem[1].incident=="blue"){
										return {
											value: geoCoordMap[dataItem[1].name]!=undefined?geoCoordMap[dataItem[1].name].concat([dataItem[1].value]):[],
											incident:dataItem[1].incident,
											incident_data:dataItem[1].incident_data
										};
									}
								})
						    }, {//省份圆点绿色事件
						    	name:"绿色事件",
						    	type: 'effectScatter',
						    	coordinateSystem: 'bmap',
						    	zlevel: 2,
						    	symbolSize: 20,
					    		// symbol:"rect",//正方形
					    		rippleEffect: {
					    			brushType: 'stroke'
					    		},
					    		itemStyle: {
					    			normal: {
						                color: function(params) {//省份圆点颜色设置
						     //    			console.log(params)
											// var tmp = params.data.incident;
											// if (tmp == 'orange') {
												// return '#ff9700';//橙色事件
											// } else if (tmp == 'green') {
												return '#00e1b4';//绿色事件
											// } else if (tmp == 'blue') {
												// return '#518fff';//蓝色事件
											// } else if (tmp == 'red') {
												// return '#ff3833';//红色事件
											// } else {
												// return '#fada00';//黄色事件
											// }
										},
										shadowColor: '#00e1b4',
										shadowBlur: 40,
										shadowOffsetX:5,
										shadowOffsetY:5,
									}
								},
								data: item[1].map(function(dataItem) {
									if(dataItem[1].incident=="green"){
										return {
											value: geoCoordMap[dataItem[1].name]!=undefined?geoCoordMap[dataItem[1].name].concat([dataItem[1].value]):[],
											incident:dataItem[1].incident,
											incident_data:dataItem[1].incident_data
										};
									}
								})
							});
});

mapOption = {
	bmap: {
						    center: data.body.center,//地图中心
						    zoom: 8,
						    roam: true
						},
						tooltip : {
							formatter: function (params, ticket, callback) {
								var incident_data=params.data.incident_data;
								var li="";
								if(incident_data!=undefined){
									for (var i = 0; i < incident_data.length; i++) {
										li=li+'<li><em>'+(i+1)+'</em><i class='+incident_data[i].color+'></i><span>'+incident_data[i].incident_name+'</span></li>'
									}
									var html='<div class="gb-incident-list scroll">'+
									'<ul>'+
									li+
									'</ul>'+
									'</div>'
									return html;
								}else{
									var html='<div class="gb-incident-list scroll">'+
									'<ul>'+
									'<li><span>无</span></li>'
									'</ul>'+
									'</div>'
									return html;
								}
							},
							enterable:true,
							position: function (point, params, dom, rect, size) {
							    // 固定在顶部
							    return {left: rect.x-($(dom).width()/2)+(rect.width/2.2), top: rect.y-$(dom).height()-10};
							},
							backgroundColor: 'rgba(255,255,255,0)',
						},
						legend: {
							orient: 'vertical',
							backgroundColor:'rgba(255,255,255,0.8)',
							top: '30',
							right: '30',
							data: ['红色事件','橙色事件','黄色事件','蓝色事件','绿色事件'],
							textStyle: {
								color: '#7c8491',
								padding:[5,0]
							},
							align:"left",
							padding:[10,25]
						},
						series: mapSeries
					};
					allMapChart.setOption(mapOption);
				    // 获取百度地图对象
				    allbmap = allMapChart.getModel().getComponent('bmap').getBMap();
				    allbmap.centerAndZoom(new BMap.Point(120.166085,30.279006), 8);
				    blist = [];
				    districtLoading = 0;
				    setTimeout(function () {
				    	var addDistrictD=data.body.addDistrict.distinct()
						// 地图划分区域地点
						for (var i = 0; i < addDistrictD.length; i++) {
							addDistrict(addDistrictD[i],allbmap);
						}
					},100)
				}
			}
		});
}
boolall=false;
}
addIncident();
// 获取事件总数和发布总数
$.ajax({
	url: portsrc+'/totalEvents',
	type: 'post',
	dataType: 'json',
	data:{
		token:token,
		type:'practice'
	},
	success: function(data) {
		$('.j-event-num').html(data.body.split('-')[0]);
		$('.j-release-num').html(data.body.split('-')[1]);
	}
});



// 全事件和单一事件切换
$(".gb-main-item").on("click",".gb-unity-incident",function(){
	$(this).addClass("cur").siblings(".gb-all-incident").removeClass("cur");
	$(".gb-all-incident-item").hide()
	$(".gb-unity-incident-item").show()
	// unityIncident();
})
$(".gb-main-item").on("click",".gb-all-incident",function(){
	$(this).addClass("cur").siblings(".gb-unity-incident").removeClass("cur");
	$(".gb-all-incident-item").show();
	$(".gb-unity-incident-item").hide();
	setTimeout(function(){
		// 全事件
		incidentChart.resize();
		incidentRankChart.resize();
		taskNumChart.resize();
		incidentTypeChart.resize();
		allMapChart.resize();
	},400)
})
// 图表随屏幕大小自适应
$(".gb-packUp-leftNav").click(function(){
	setTimeout(function(){
		if($(".gb-all-incident").hasClass('cur')){
			// 全事件
			incidentChart.resize();
			incidentRankChart.resize();
			taskNumChart.resize();
			incidentTypeChart.resize();
			allMapChart.resize();
		}else{
			// 单一事件
			populationChart.resize();
			districtChart.resize();
		}
	},400)
})
// 数组去重	
Array.prototype.distinct = function() {
	var arr = this,
	result = [],
	i,
	j,
	len = arr.length;
	for (i = 0; i < len; i++) {
		for (j = i + 1; j < len; j++) {
			if (arr[i] === arr[j]) {
				j = ++i;
			}
		}
		result.push(arr[i]);
	}
	return result;
}



/*table*/
// $(function () {
	var table1 = $('#table-main1 table').DataTable({
		"scrollY": "calc(100% - 50px)",
		"scrollX": true,
		"dom": '<"top"f >rt<"bottom"ilp><"clear">',//dom定位
		"dom": 'tiprl', //自定义显示项
		"lengthMenu": [2, 6, 10, 16, 24], //每页显示条数设置
		"lengthChange": true, //是否允许用户自定义显示数量
		"bPaginate": true, //翻页功能
		"bFilter": true, //列筛序功能
		"searching": true, //本地搜索
		"order": [4, "asc"], //desc降序
		"Info": true, //页脚信息
		"oLanguage": oLanguage,
		"ajax": {
			url: portsrc+'/practice/all',
			type: 'post',
			data:{
				token:token,
			},
			dataSrc: function (data) {

				for ( var i=0, ien=data.body.length ; i<ien ; i++ ) {

					var d=data.body[i];
					data.body[i].department= '';
					data.body[i].dutyPerson='';
                	// delete data.body[i].status;
                	// delete data.body[i].receiptTime;
                	// delete data.body[i].feedBackTime;
                	// delete data.body[i].audit;
                	var level="";
                	if(d.level=="RED"){
                		level="<img src='src/images/rank-red.png'/>";
                	} else if(d.level=="BLUE"){
                		level="<img src='src/images/rank-blue.png'/>";
                	} else if(d.level=="GREEN"){
                		level="<img src='src/images/rank-green.png'/>";
                	} else if(d.level=="ORANGE"){
                		level="<img src='src/images/rank-orange.png'/>";
                	} else if(d.level=="YELLOW"){
                		level="<img src='src/images/rank-yellow.png'/>";
                	}
                	if (d.type== 'MANNUAL') {
                		data.body[i].type='manual';
                	}else if (d.type== "CYCLE") {
                		data.body[i].type='cycle';
                	}
					// data.body[i].status='已创建';
					data.body[i].level='<span class="rankimg" vel="'+d.level+'">'+level+'</span>';
					data.body[i].name="<a class='view-cont'>"+d.name+"</a>";
					data.body[i].department?data.body[i].department=d.department:data.body[i].department='';
					data.body[i].dutyPerson?data.body[i].dutyPerson=d.dutyPerson:data.body[i].dutyPerson='';
					data.body[i].time=d.time;
					data.body[i].tomonitoring='<input type="button" value="监控" id="'+data.body[i].id+'" data-type="'+data.body[i].type+'" class="tomonitoring j-tomonitoring" />';
				}
                // console.log(data.body);
                return data.body;
            }
        },
        "columns": [
        { "data": "level" },
        { "data": "name" },
        { "data": "department" },
        { "data": "dutyPerson" },
        { "data": "time" },
        { "data": "tomonitoring" }
        ],
        "columnDefs": [{
        	orderable: false,
				targets: [0,1,2,5] //禁止排序
			}, {
				"sType": "html-percent",
				"aTargets": [0] //指定列号使用自定义排序
			}
			],
		initComplete: function() { //列筛选
			var api = this.api();
			api.columns().indexes().flatten().each(function(i) {
				var column = api.column(i);
                if (i == 2) { //对第i列进行筛选
                	rowScreen(column);
                }else if (i==0) { //对第i列进行筛选
                	rowLevScreen(column);
                }
            });
		},
		fnDrawCallback: function(table) {  
			jumpPage($("#table-main1"))
		}
	});

	var table2 = $('#table-main2 table').DataTable({
		"scrollY": "calc(100% - 50px)",
		"scrollX": true,
        "dom": '<"top"f >rt<"bottom"ilp><"clear">',//dom定位
		"dom": 'tiprl', //自定义显示项
		"lengthMenu": [10,30,40,50], //每页显示条数设置
		"lengthChange": true, //是否允许用户自定义显示数量
		"bPaginate": true, //翻页功能
		"bFilter": true, //列筛序功能
		"searching": true, //本地搜索
		//"ordering": true, //排序功能
		"order": [4, "asc"], //desc降序
		"Info": true, //页脚信息
		"oLanguage": oLanguage, //国际语言转化
		"ajax": {
			url: portsrc+'/unityMessage',
			type: 'post',
			data:{
				token:token,
				id:'0',
				type:'practice'
			},
			dataSrc: function ( data ) {
            	// console.log(data);
            	return data.body;
            }
        },
        "columns": [
        { "data": "area" },
        { "data": "conver" },
        { "data": "receipts" },
        { "data": "feedback" },
        { "data": "receiptstime" },
        { "data": "feedbacktime" }
        ],
        "columnDefs": [
        {
        	orderable: false,
				targets: [0,1,2,3]//设置某列禁止排序
			}
			], 
		initComplete: function() { //列筛选
			var api = this.api();
			api.columns().indexes().flatten().each(function(i) {
				if (i == 3) { //对第i列进行筛选
					var column = api.column(i);
					rowScreen(column);
				}
			});
		},
		fnDrawCallback: function(table) {
			jumpPage($("#table-main2"))
		}
	});

	// 全事件表格
	var table3 = $('#table-main3 table').DataTable({
		"scrollY": "calc(100% - 50px)",
		"scrollX": true,
    "dom": '<"top"f >rt<"bottom"ilp><"clear">',//dom定位
	"dom": 'tiprl', //自定义显示项
	"lengthMenu": [10,30,40,50], //每页显示条数设置
	"lengthChange": true, //是否允许用户自定义显示数量
	"bPaginate": true, //翻页功能
	"bFilter": true, //列筛序功能
	"searching": true, //本地搜索
	//"ordering": true, //排序功能
	"order": [4, "asc"], //desc降序
	"Info": true, //页脚信息
	"oLanguage": oLanguage, //国际语言转化
	"ajax": {
		url: portsrc+'/taskList',
		type: 'post',
		data:{
			token:token,
			type:'practice'
		},
		dataSrc: function ( data ) {
			if(data.body!=null){
				for ( var i=0, ien=data.body.length ; i<ien ; i++ ) {
					var d=data.body[i];

					var level="";
					if(d.level=="RED"){
						level="<img src='src/images/rank-red.png'/>";
					} else if(d.level=="BLUE"){
						level="<img src='src/images/rank-blue.png'/>";
					} else if(d.level=="GREEN"){
						level="<img src='src/images/rank-green.png'/>";
					} else if(d.level=="ORANGE"){
						level="<img src='src/images/rank-orange.png'/>";
					} else if(d.level=="YELLOW"){
						level="<img src='src/images/rank-yellow.png'/>";
					}
					data.body[i].level='<span class="rankimg" vel="'+d.level+'">'+level+'</span>';
					data.body[i].type='类别';

					data.body[i].name="<a class='view-cont'>"+d.name+"</a>";
				}
			}
			return data.body;
		}
	},
	"columns": [
	{ "data": "state" },
	{ "data": "level" },
	{ "data": "name" },
	{ "data": "type" },
	{ "data": "area" },
	{ "data": "population" },
	{ "data": "department" },
	{ "data": "dutyPerson" },
	{ "data": "time" }
	],
	"columnDefs": [
	{
		orderable: false,
				targets: [0,1,2,3,5,6]//设置某列禁止排序
			}, {
				"sType": "html-percent",
				"aTargets": [1] //指定列号使用自定义排序
			}
			], 
		initComplete: function() { //列筛选
			var api = this.api();
			api.columns().indexes().flatten().each(function(i) {
				var column = api.column(i);
            if (i==1) { //对第i列进行筛选
            	rowLevScreen(column);
            }
        });
		},
		fnDrawCallback: function(table) {
			jumpPage($("#table-main3"))
		}
	});

	userDef(table1);//table配置--显示数量 搜索 全选 删除  
	$(".gb-main-item").on("click",".gb-unity-incident",function(){
		setTimeout(function(){
			table1.draw();
			table2.draw();
			// console.log($('#table-main1 tbody tr').eq(0).find('.j-tomonitoring'));
			$('#table-main1 tbody tr').eq(0).find('.j-tomonitoring').trigger('click');
		},10)
	})
	$("body").on("click",".j-table-chart-tab em",function(event) {
		if (incidentTypeChart) {
			incidentTypeChart.resize();
		}
		if (populationChart) {
			populationChart.resize();
		}
		if (districtChart) {
			districtChart.resize();
		}
		if($(this).hasClass("list")){
			setTimeout(function(){
				table2.draw();
				table3.draw();
			},10)
		}
	});
	$("body").on("click",".j-table-chart-tab em",function(event) {
		incidentTypeChart.resize();
		if($(this).hasClass("list")){
			setTimeout(function(){
				table2.draw();
				table3.draw();
			},10)
		}
	});
	$(".gb-packUp-leftNav").click(function(){
		setTimeout(function(){
			table2.draw();
			table3.draw();
		},500)
    });//重绘
	$(document).on('click','.tomonitoring',function(){
		$('.tomonitoring').removeClass('tomact');
		$(this).addClass('tomact');
		boolunity=true;
		unityIncident($(this).attr('id'),$(this).data('type'));
		sessionStorage.setItem('editTableItem',$(this).attr('id'));
		sessionStorage.setItem('tomonitoringType',$(this).data('type'));
	})

//})

// setTimeout(function () {
// 	console.log($('#table-main1 tbody tr').eq(0));
// 	$('#table-main1 tbody tr').eq(0).find('.j-tomonitoring').trigger('click');
// },1000)
</script>